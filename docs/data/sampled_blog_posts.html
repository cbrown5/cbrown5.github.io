<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Diary of becoming a Bayesian – Seascapemodels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-f93c2b1f3f0577f377aefa4848a86a36.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-6.7.2/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-6.7.2/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Seascapemodels</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../bluecology_blog.html"> 
<span class="menu-text"><i class="fa-regular fa-newspaper" aria-label="newspaper"></i> Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../people.html"> 
<span class="menu-text"><i class="fa-regular fa-user" aria-label="user"></i> People</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../code.html"> 
<span class="menu-text"><i class="fa-solid fa-laptop-code" aria-label="laptop-code"></i> R tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com.au/citations?hl=en&amp;user=1qG6yFMAAAAJ&amp;view_op=list_works&amp;sortby=pubdate"> 
<span class="menu-text"><i class="fa-brands fa-google-scholar" aria-label="google-scholar"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://discover.utas.edu.au/C.J.Brown"> 
<span class="menu-text"><i class="fa-solid fa-building-columns" aria-label="building-columns"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cbrown5"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/bluecology.bsky.social"> 
<span class="menu-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/christopher-brown-32466785/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Diary of becoming a Bayesian</h1>
  <div class="quarto-categories">
    <div class="quarto-category">rstats</div>
    <div class="quarto-category">research-skills</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">3/18/2019</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="sampled-blog-posts-for-style-analysis" class="level1">
<h1>Sampled Blog Posts for Style Analysis</h1>
<hr>
<section id="post-2022-09-04-insights-ngo-science-symposium" class="level2">
<h2 class="anchored" data-anchor-id="post-2022-09-04-insights-ngo-science-symposium">POST: 2022-09-04-insights-NGO-science-symposium</h2>
<p>Path: posts/2022-09-04-insights-NGO-science-symposium/index.md</p>
<p>I attended a symposium for scientists and non-governmental organisations at the Centre for Biodiversity and Conservation Science at the University of Queensland recently.</p>
<p>The aim of the symposium was to promote more collaboration between NGOs and conservation scientists. Here are some of the key lessons I took home.</p>
<p>One researcher told me she wish she’d had such a symposium when she started her PhD. It would have given her the know-how needed to reach out to NGOs and start collaborating as part of her PhD.</p>
<p>So here are the key lessons.</p>
<ol type="1">
<li><p><strong>Look up NGOs in your area and read about their science priorities.</strong> Many, like <a href="https://birdlife.org.au/">Birdlife Australia</a> (who presented at there) publish their science priorities.</p></li>
<li><p><strong>Get in touch with NGO staff.</strong> If you know someone who knows someone at an NGO that is great. Start by asking your supervisor. If not, try just emailing the contact on the NGOs webpage and say you are a scientist looking to align your research for more impact.</p></li>
<li><p><strong>Ask what their science needs are.</strong> If you can get a meeting with the NGO staff, great. But don’t waste your meeting pitching your ideas to them. Listen first. Find out what their problems and issues are. They probably have science needs outlined already. For instance, the presenter from The Wilderness Society pitched several ideas they’d love to have science on for their advocacy work. These included analyses of national threats to Australian fauna and attribution of extinction risk to specific industries.</p></li>
<li><p><strong>Align your science with their priorities.</strong> The next step would be to come up with a research plan. Make sure it aligns with their priorities. If you can get time with the NGO, pitch the plan back to them (its ok to pitch now that you’ve listened to what their needs are). If you can’t, you may still like to go ahead and do the research in the hope they pick it up later. For instance, Birdlife Aus has aligned their science awards to their priorities.</p></li>
<li><p><strong>Be mindful of timelines.</strong> NGO timelines are often fast moving. Their priorities can shift rapidly as funding or politics change. This can be a challenge for research projects.</p></li>
</ol>
<p>For PhD students I wouldn’t recommend projects that have strict deliverables to a deadline. For instance, they may need to deliver results in a timely manner to be able to influence major new government policies. Or they may be looking to contract someone to prepare a report. PhDs need time to learn and this often takes longer than NGO timelines.</p>
<p>That being said, NGOs often have many research ideas they’d like to do, but which their work isn’t directly dependent on. These kinds of projects can be great for students. Just be mindful that if the research drags on too long (like years) the NGO may shift their priorities and you’ll lose engagement.</p>
<p>So aim for projects that need 6 months to a year to complete. Talk to your supervisor about projecting time needed, as we all tend to underestimate that.</p>
<ol start="5" type="1">
<li><strong>NGOs are often under-resourced.</strong> Which means they probably won’t have bucket loads of funding for your project, but they do love help where they can get it. If you are a PhD student with time and capacity to share, then they’ll probably love that. So don’t be shy about reaching out.</li>
</ol>
<p>Just be sure to plan your engagement with NGOs with a mentor or supervisor. You want to make sure you align the project with your skillset and feasible timelines for providing results.</p>
<p>Working with NGOs has been one of the most rewarding parts of my career. As an academic (and as a student) I have the luxury of getting to spend some of my time on passion projects. Sometimes the ‘work for free’ has then lead onto funded work.</p>
<p>The research I’ve done with NGOs has often lead to real world impact. These stories have become a core part of my career story that has built my reputation, and which I also look back on as the most rewarding experiences of my career.</p>
<hr>
</section>
<section id="post-2025-10-04-running-github-copilot-cli-agents-from-r" class="level2">
<h2 class="anchored" data-anchor-id="post-2025-10-04-running-github-copilot-cli-agents-from-r">POST: 2025-10-04-running-github-copilot-CLI-agents-from-R</h2>
<p>Path: posts/2025-10-04-running-github-copilot-CLI-agents-from-R/index.md</p>
<p><a href="https://docs.github.com/en/copilot/concepts/agents/about-copilot-cli">Github Copilot CLI (Command Line Interface)</a> recently became available. It is an AI agent, meaning it can use tools autonomously in a loop. It has two modes:</p>
<ol type="1">
<li><p>An interactive mode that is like a terminal version of the Copilot agent that runs in the chat window</p></li>
<li><p>A programmatic mode that can be run with shell scripts.</p></li>
</ol>
<p>The Copilot CLI is available with paid versions of github copilot.</p>
<p>The programmatic mode interested me, because it allows you to write scripts that call github copilot agents. This means you could run replicate agents on the same problem, then gather there results for analysis.</p>
<p>I, of course, want to do everything from the R program, because I’m not great with unix code or Python. <a href="https://docs.github.com/en/copilot/how-tos/set-up/install-copilot-cli">Once you’ve setup the copilot CLI</a>, its very easy to run it from R:</p>
<pre><code>
copilot_cmd &lt;- "copilot -p 'Set-up this project directory with a readme.md file, and directories for outputs, scripts, plots.' --allow-all-tools"

system(copilot_cmd)
</code></pre>
<p>This will run the agent autonomously in the current working directory of your R session.</p>
<p>Now I wouldn’t recommend using <code>--allow-all-tools</code> like this however. <a href="https://docs.github.com/en/copilot/concepts/agents/about-copilot-cli#security-considerations">There are important security considerations</a>. Like prompt injection attacks where an Agent goes on the web and gets tricked into doing something bad to your computer when it reads some malicious content. Likewise, agents can just stuff up and just delete or overwrite a bunch of files you wanted to keep.</p>
<p>You do need to allow some tools however, otherwise you might as well run the agent in interactive mode (because you’ll have to manually approve every tool use). This defeats the time-saving goal of running agents in a loop.</p>
<p>Here’s my current set-up:</p>
<p><code>copilot -p 'A prompt here' --allow-all-tools --deny-tool 'shell(cd)' --deny-tool 'shell(git)' --deny-tool 'shell(pwd)' --deny-tool 'fetch' --deny-tool 'extensions' --deny-tool 'websearch' --deny-tool 'githubRepo'"</code></p>
<p>I allow all tools, then prevent tools related to changing working directory, accessing the web or viewing directory context.</p>
<p>There is still some risk here. e.g., if you want it to run Rscripts you might want to include in your prompt something like ‘Use <code>Rscript my-script.R</code> to run R scripts from the terminal.’ The R scripts could include anything (including connecting to the web).</p>
<p>Here’s an example in action. I use sprintf to format the terminal command with the prompt, tools and sub-directory path.</p>
<pre><code>copilot_prompt &lt;- "Set-up this project directory with a readme.md file, and directories for outputs, scripts, plots. Then create example data to illustrate a poisson GLM. Make prediction plots. Use `Rscript 'my-script.R'` to run R files. "

copilot_tools &lt;- "--allow-all-tools --deny-tool 'shell(cd)' --deny-tool 'shell(git)' --deny-tool 'shell(pwd)' --deny-tool 'fetch' --deny-tool 'extensions' --deny-tool 'websearch' --deny-tool 'githubRepo'"

subdir_path &lt;- "dir1"

 copilot_cmd &lt;- sprintf(
    "cd '%s' &amp;&amp; copilot -p '%s' %s",
    subdir_path,
    copilot_prompt,
    copilot_tools
  )

system(copilot_cmd)
</code></pre>
<p>From here it would be easy to create a loop over different subdirectory paths, and run a separate agent in each one. The advantage of <code>cd</code>ing into each path before the agent opens is that the agent can’t then see context from other sub-directories. So you get independent agent runs.</p>
<p>You could use this to see how different prompts perform, or do complex prompt strategies like ‘tree of thought’. In tree of thought you ask an agent to create the same thing many times, it will do it slightly differently each time. Then you aggregate the results and pick the most common or most accurate one.</p>
<p>My one gripe is that Github have provided us with woeful documentation of what the tool names are. I’m guessing the tools are what you can see if you open the chat window, click ‘Agent’ mode, then click the tool symbol.</p>
<p>I’d love to have some default tool sets that simplify the tool permissions. For instance a tool set that locks down all web access.</p>
<hr>
</section>
<section id="post-2024-02-08-secret-recipe-to-writing-papers" class="level2">
<h2 class="anchored" data-anchor-id="post-2024-02-08-secret-recipe-to-writing-papers">POST: 2024-02-08-secret-recipe-to-writing-papers</h2>
<p>Path: posts/2024-02-08-secret-recipe-to-writing-papers/index.md</p>
<ol type="1">
<li><p>Work with good collaborators that you know well and who you can rely on.</p></li>
<li><p>Have clearly defined roles for yourself and collaborators.</p></li>
<li><p>Don’t have too many collaborators (three or less or have none). There’s lots of time in coordinating with many people.</p></li>
<li><ol start="2" type="a">
<li>Sub-point - non-research collaborators (e.g.&nbsp;industry/NGOs) can also take a lot of time, but see points 1 and 2.</li>
</ol></li>
<li><p>Have a clearly defined plan.</p></li>
<li><p>Have a relatively simple question to address, one that can be clearly defined as 1-3 aims/hypotheses and the methods need to be clear and well established (and things you or your collaborotors can easily do)</p></li>
<li><p>Don’t get too hung on how much work it takes to write ‘The Paper’. The amount of time it takes is hugely variable and there is no minimum time.</p></li>
<li><p>80/20 rule - 20% of the effort for 80% of the results.</p></li>
<li><p>Have some skills. Be decent at writing. Have some methodology skills (e.g.&nbsp;modelling or field work skills) that are well known to you and you will rely on for this study. Flip side is don’t expect to write a paper if you are still learning to write scientifically (e.g.&nbsp;early in your PhD).</p></li>
<li><p>Work with a system you know well, e.g.&nbsp;a study system, lab system or type of modelling/data for analysis.</p></li>
<li><p>In general reviews and perspectives take 10x times longer than you think they will. A lot of thought goes into word crafting (though sometimes they can be really quick).</p></li>
<li><p>Don’t get too hung up on what journal it ‘HAS’ to go to. Sometimes you start a paper thinking it has Nature potential, but if it turns out it doesn’t then just get it done (see steps 6 and 7!) and submit it to a disiplinary journal.</p></li>
</ol>
<hr>
</section>
<section id="post-2016-03-06-how-long-to-write-grant" class="level2">
<h2 class="anchored" data-anchor-id="post-2016-03-06-how-long-to-write-grant">POST: 2016-03-06-how-long-to-write-grant</h2>
<p>Path: posts/2016-03-06-how-long-to-write-grant/index.md</p>
<section id="how-long-does-it-take-to-write-for-major-national-grants" class="level3">
<h3 class="anchored" data-anchor-id="how-long-does-it-take-to-write-for-major-national-grants">How long does it take to write for major national grants?</h3>
<p>During “grant season” (~Dec - March in Aus) you might find your colleagues bemoan all the work they have to do writing grants, or turning down meetings because they are too busy. I certainly felt that way writing for a major <a href="http://www.arc.gov.au">Australian Research Council grant</a> this year.</p>
<p>But, I wondered how much time does it take to write for a national grant scheme. Since October I have been logging the hours I spend on different projects, like a consultant, in an effort to gain data on project time and improve my time-management. I added up the time I spent writing for an ARC grant, where I was lead author, and the answer surprised me:</p>
<section id="hours-and-30-minutes-or-nearly-12-full-working-days-at-least1" class="level4">
<h4 class="anchored" data-anchor-id="hours-and-30-minutes-or-nearly-12-full-working-days-at-least1"><em>69 hours and 30 minutes or nearly 12 full working days (at least<sup>1</sup>)</em></h4>
<div class="image_caption">
<img src="ARC_DP2017.png" alt="timebarchart" class="image_float">
<p>
Time spent by days writing for a grant 
</p>
</div>
<p>A few caveats on my estimate, which is certainly an under-estimate. It counts writing, formal (organised) meetings with co-authors, budgeting, some reading and all the administrative stuff. The time doesn’t count emails, reading papers, or time thinking while bike-riding, walking the pram, trying to go to sleep etc…</p>
<p>The time also doesn’t count time from my colleagues. The grant includes significant input from 3 collaborators and numerous reviews from non-collaborators and research office staff. Also, I started records in November, so prep work before hand (including an internal pre-review) isn’t counted here.</p>
<p>Some further context for this grant. There is likely to be considerable variability for different people and projects. I am an early career researcher, so maybe my time is slower than more experience researchers, or better writers. However, I did put in for an <a href="../research/2015/11/03/decra.html">ARC grant</a> last year so I had a head start on some of the sections about your CV and research contributions. I am also familiar with the ARC format, something I spent a considerable amount of time figuring out the first time I put in for a grant.</p>
<p>My grant is also modelling focussed, so that probably saved me some time in the budgeting step, as that could get very tricky if there was lots of field work to budget for.</p>
<div class="image_caption">
<img src="ARC-submitted.png" alt="timebarchart" class="image_float">
<p>
The screen you see on completion of 12 days solid work 
</p>
</div>
</section>
</section>
<section id="maybe-12-days-underestimates-the-mental-effort" class="level3">
<h3 class="anchored" data-anchor-id="maybe-12-days-underestimates-the-mental-effort">Maybe 12 days underestimates the mental effort?</h3>
<p>12 days doesn’t sound like as much as I was expecting. However, maybe the raw numbers under-estimate the mental effort that goes into grant writing. I probably have at most 3-4 hours maximal mental effort per day, which makes the grant look more like a month’s solid work, using the best hours of the day.</p>
<p>I will be interested to hear how much time other people (<a href="http://www.twitter.com/bluecology">tweet me</a>) spend on grants and whether my numbers sound reasonable.</p>
<p>As a footnote, the message you get when you finally hit submit is rather disappointing (see image). Consider that it takes <a href="http://www.mounteverest.net/expguide/route.htm">~33 hours of climbing to ascend Everest from base camp</a> and you will be rewarded with a view from the top of the world. Or for a computing analogy, if you complete a computer game you are usually rewarded with a video and the solution to the game’s story. It takes only about <a href="http://howlongtobeat.com/game.php?id=10025">13 hours</a> to complete some of the best selling computer games. Obviously the final rewarded is receiving the grant and successfully investigating your ideas, but that is a highly uncertain outcome (~15% success rate for ARCs) that is years down the track. It would be nice if online grant submissions unlocked some kind congratulations page.</p>
<ol type="1">
<li>Note added 8/03/2016. I have discussed this post with several colleagues all of whom suggests it takes much longer than 70 hours to write a major grant. As I have not included time for reading and thinking in my estimate, it is likely that time would add considerably to the time taken to complete the grant.</li>
</ol>
<hr>
</section>
</section>
<section id="post-2025-07-07-writing-papers-with-quarto" class="level2">
<h2 class="anchored" data-anchor-id="post-2025-07-07-writing-papers-with-quarto">POST: 2025-07-07-writing-papers-with-quarto</h2>
<p>Path: posts/2025-07-07-writing-papers-with-quarto/index.md</p>
<p>Below is my suggested workflow for using quarto to write scientific papers. I’m currently switching to doing as many projects as possible with quarto rather than word for a few reasons:</p>
<ol type="1">
<li>Easier to manage document style</li>
<li>Easier to manage references</li>
<li>Workflows that auto-update figures/tables when R code is re-run</li>
<li>Generative AI integration that is customizable.</li>
</ol>
<p>Point 3 is great, no more cut and pasting figures into word documents!</p>
<p>Point 4 is the big one. I’m developing my own ‘writing mentor’ scripts for large language models. Using quarto lets me implement writing advice specific to science direclty into my manuscripts.</p>
<p>Quarto is ‘What You See is What you Make’, meaning that you write special syntax for formatting. Once you are used to it, this is way easier way to manage styles than word.</p>
<p>The downside is getting your (non-coding) collaborators to edit files in quarto. This is the biggest bottleneck to my use of quarto/markdown. Currently I send them word documents then have to manually integrate the feedback. Or I work in quarto until the near final stages, accepting comments only, then get them to edit the final manuscript.</p>
<p>For instance, <a href="https://conbio.onlinelibrary.wiley.com/doi/full/10.1111/cobi.13079?casa_token=zF8vihnFfcMAAAAA%3A9WlbXPCghdwS2WvyRqGjRqYPrng7q4_xPwZvu9K52p6gd_8lWs2qcgrehfg4ehAThC7ni32Ybr02iA">I wrote most of this paper in markdown</a> but had to go to word editing towards the end so I could get edits from my collaborator. Once you’ve progressed it in word, its hard to go back to markdown.</p>
<p>Instructions below are high level. There are quite a few pieces of software you need to do this, so I’ve linked to tutorials for each below.</p>
<section id="download-and-install-an-ide" class="level3">
<h3 class="anchored" data-anchor-id="download-and-install-an-ide">1. Download and install an IDE</h3>
<p>Download and install VScode.</p>
<p><a href="https://www.seascapemodels.org/rstats/2025/06/12/setting-up-vscode-r-genAI.html">Instructions online e.g.&nbsp;here</a></p>
<p>I’m using VScode because of its AI assistant integration. But you could also use positron if you have issues with VScode or want to use a Posit product rather than a Microsoft product.</p>
</section>
<section id="get-git-and-github" class="level3">
<h3 class="anchored" data-anchor-id="get-git-and-github">2. Get git and github</h3>
<p>Install git on your computer. Optionally, get a github account and connect to that. Git does version control. Github lets you share that online. If your collaborators are github users then you can also share edits on documents this way.</p>
<p>Git is also essential if you are using AI assistants. Sometimes they majorly stuff up your documents. So keeping back ups with git is essential.</p>
</section>
<section id="vscode-extensions" class="level3">
<h3 class="anchored" data-anchor-id="vscode-extensions">3. VScode extensions</h3>
<p>Install these VScode extentions (or equivalents if you are using positron, note that many vscode extensions are also compatable with Positron)</p>
<ul>
<li>Quarto extension.</li>
</ul>
<p>Open VSCode and click the four boxes ‘extension’ icon on the LHS then search and install the Quarto extension.</p>
<p>Optional extensions: - R language extension (<a href="https://www.seascapemodels.org/rstats/2025/06/12/setting-up-vscode-r-genAI.html">can be tricky to connect VScode to R, suggest you web search for advice</a>)</p>
</section>
<section id="optional-steps-for-ai-integration" class="level3">
<h3 class="anchored" data-anchor-id="optional-steps-for-ai-integration">4. Optional steps for AI integration</h3>
<p>This next step is optional. If you are using quarto or markdown its possible to get large-language models to help with many paper writing tasks (including the writing). This is a specialized area though and I’ve only given basic technical instructions here. Actually getting it to work well is another topic altogether and something I’m still developing…</p>
<p>Get an API key with an LLM provider (e.g.&nbsp;<a href="https://openrouter.ai/sign-up">OpenRouter</a>, <a href="https://platform.openai.com/api-keys">OpenAI</a>, <a href="https://console.anthropic.com/login?returnTo=%2F%3F">Anthropic</a>). You’ll need a developer account to get an API key, rather than a regular account that you may already have (see links in last sentence). Buy some credits so you can use your API.</p>
<p>Make sure you save your API key somewhere safe! You can usually only view them once on creation. You’ll need it for the workshop.</p>
<p>Get the Roo Code extension for vscode/positron.</p>
<p><a href="https://docs.roocode.com/">Read the documents/watch the tutorials and learn how to use Roo Code</a></p>
<p>You can now <a href="https://docs.roocode.com/features/custom-modes">create a custom mode</a>, e.g.&nbsp;a ‘scientific writing mode’ in Roo code. As of writing this requires clicking the mode selection button at the bottom of the Roo Code Pane, then click the Cog, then the <code>+</code> button to make a new mode. Then you need to write a ‘Role Definition’ and ‘Custom instructions’. For tools I just use ‘Read Files’, ‘Edit Files’ and unclick the others (will save you money and tokens).</p>
<p>This is the hard part that needs a lot of thought:</p>
<p>In the custom instructions you should write detailed instructions on how to help an author with scientific writing. For instance, you might want to put some very strong instructions about not making up references. You might also put instructions about your particular writing style preferences. I’m working on a template, but am not yet ready to share it.</p>
<p>See <a href="https://docs.roocode.com/features/custom-modes">Roo code documentation</a> for more advice on custom modes.</p>
</section>
<section id="using-quarto" class="level3">
<h3 class="anchored" data-anchor-id="using-quarto">5. Using quarto</h3>
<p>Take a tutorial and <a href="https://quarto.org/docs/get-started/hello/rstudio.html">learn how to use Quarto</a>.</p>
<p>For academic paper writing the key things to understand from the Quarto tutorial are:</p>
<ul>
<li>How to knit as word or pdf (pdf requires extra software installations)</li>
<li>Formatting, headings, bold etc…</li>
<li>YAML frontmatter for styles, linking a bibliography and bibliography style</li>
<li>How to insert images and/or code.</li>
</ul>
<p><strong>Note on AI integration</strong> once you are using quarto and Roo Code you can simply ask Roo Code to do things in your document (like outline a paper template) by referencing the file (e.g. <span class="citation" data-cites="myfile.qmd">@myfile.qmd</span>) in the prompt box.</p>
<p>Whether this works well for you is another questions. Prompting well requires a lot of thought and practice. Its not simply going to write a paper for you. You have to give the AI assistant detailed, specific, instructions and lots of context.</p>
</section>
<section id="yaml-front-matter" class="level3">
<h3 class="anchored" data-anchor-id="yaml-front-matter">6. YAML front matter</h3>
<p>The <code>YAML</code> controls how your qmd document is rendered. Here’s an example of mine:</p>
<pre><code>---
title: "The paper's title"
format: docx
editor: visual
bibliography: mybib.bib
csl: myjournal.csl
execute: 
  echo: false
  message: false
  warning: false
---</code></pre>
<p>This goes at the top of your document. A few key points.</p>
<p><code>format</code> controls document type to render this as, here a word doc.</p>
<p><code>editor</code> controls how it is viewed in vscode. Options are <code>editor: visual</code> and <code>editor: source</code>. Visual looks more like a word doc, source looks more like markdown. You’ll have to save and re-open the document for this to change.</p>
<p><code>bibliography</code> links to a bibtex file where your references are stored.</p>
<p><code>csl</code> links to a style guide for the bibliography.</p>
<p>More on styles and references below.</p>
<p><code>execute</code> is controlling how R code is run and if the R code appears in the document.</p>
</section>
<section id="rendering-as-a-document" class="level3">
<h3 class="anchored" data-anchor-id="rendering-as-a-document">7. Rendering as a document</h3>
<p>Use the short-cut key ‘cmd-shift-K’/‘cntrl-shft-k’ (mac/windows) to preview your document. It will also create a rendered version in your current directory.</p>
<p>Its helpful to set: <code>format: html</code> when you are writing the document, then you get a live preview in vscode. Use <code>format: docx</code> when you want a word document.</p>
<p>Its worth also learning the short-cut `cmd-shft-p’/‘cntrl-shft-p’, this brings up searchable actions for all extensions in vscode. The one you want is ‘Quarto: preview’ which does the same as the shortcut above.</p>
<p>I tend to have minimal R code in my quarto manuscript. Or none at all (just reference .png files for figures). This keeps rendering quick. Also your document can get unweildy if there is a lot of text mixed in with R code.</p>
</section>
<section id="word-counts" class="level3">
<h3 class="anchored" data-anchor-id="word-counts">8. Word counts</h3>
<p>There are various word count extensions for vscode qmd and md documents.</p>
</section>
<section id="document-styles" class="level3">
<h3 class="anchored" data-anchor-id="document-styles">9. Document styles</h3>
<p>Getting a word document to follow a particular style is a bit fiddly. You need to set-up a template word document with styles the include that as a reference in your YAML.</p>
<p><a href="https://quarto.org/docs/output-formats/ms-word-templates.html">See instructions here.</a></p>
</section>
<section id="reference-manager-integration" class="level3">
<h3 class="anchored" data-anchor-id="reference-manager-integration">10. Reference manager integration</h3>
<p>Quarto integrates with many different reference managers. <a href="https://quarto.org/docs/authoring/citations.html">There’s a good guide here</a>.</p>
<p>In brief you create a <code>.bib</code> file that has your references in it. This is then linked in the YAML. The manual way to manage this is just to create a <code>.bib</code> file and paste bibtext entries directly into it (available on most journal’s pages as a citation format, as well as google scholar).</p>
<p>e.g.&nbsp;the bibtext for R looks like this:</p>
<pre><code>@Manual{Rlanguage,
    title = {R: A Language and Environment for Statistical Computing},
    author = {{R Core Team}},
    organization = {R Foundation for Statistical Computing},
    address = {Vienna, Austria},
    year = {2024},
    url = {https://www.R-project.org/},
  }</code></pre>
<p>Then in quarto you just type <code>@</code> and a dropdown of all your references will appear. <code>@Manual{Rlanguage,</code> the Rlanguage bit is the CiteKey that will appear in the dropdown. So <code>@Rlanguage</code> will insert that reference into the bibliography and the citation at that place in the document.</p>
<p>You can streamline the process of gathering and managing references with a reference manager.</p>
<p>My workflow in Zotero is as follows:</p>
<ul>
<li>Open Zotero on my computer</li>
<li>Go to journal webpage for paper</li>
<li>Use zotero plugin to my browser to grab the citation and save it to a library</li>
<li>Go to my quarto document in VScode</li>
<li>type <code>@</code> and a drop down of all references in all libraries on zotero appears. Pick the one I want.</li>
<li>Click the <code>OK</code> button which saves that reference into my local <code>.bib</code> file.</li>
</ul>
<p>For some reason (that does not seem to be documented in any quarto tutorials anywhere!) it will find any reference I have anywhere in zotero and then save that bibtex entry to my local <code>.bib</code> file, so it is now accessible for use in my quarto doc. This only works if I have zotero open and use <code>editor: visual</code> in the YAML.</p>
<p>There are many other options however.</p>
</section>
<section id="optional-ai-integration-for-reference-management" class="level3">
<h3 class="anchored" data-anchor-id="optional-ai-integration-for-reference-management">11. Optional AI integration for reference management</h3>
<p>You can get AI assistants to help with referencing if you keep your notes on papers linked to your references. For instance, you could keep your notes on references in the bibtex field for <code>notes</code>. Alternatively you could create another quarto/markdown document that has a header for each citation tag along with its notes in a structured way:</p>
<pre><code>## Rlanguage 

### What it is

The R software for scientific computing. 

### Usage

Citation for the R software. Use this at least once in every paper where i've used R for statistics

## edgar2023continent

### What is it

Key paper that shows Australia is losing its marine biodiversity. 

### Usage

Cite this as evidence that Australia is losing coastal marine biodiversity and as evidence that climate change is causing marine biodiversity loss
</code></pre>
<p>It doesn’t matter how you do this, so long as you follow a consistent structure. I’ve used the CiteKey as the main header for each reference entry. Then I’ve put in markdown sections about each paper and why I might wnat to cite it. Then you can get Roo Code to help with inserting references.</p>
<p>Note that if you are using the <code>.bib</code> directly just be careful not to plagiarise! Roo Code might insert excerpts from the abstracts/titles directly into your written document, which is a no-no for publishing.</p>
<hr>
</section>
</section>
<section id="post-2023-06-15-bayesian-sem-tute" class="level2">
<h2 class="anchored" data-anchor-id="post-2023-06-15-bayesian-sem-tute">POST: 2023-06-15-bayesian-sem-tute</h2>
<p>Path: posts/2023-06-15-bayesian-sem-tute/index.md</p>
<p>Structural equation modelling (SEM) is a tool for exploring relationships among multiple variables. <code>lavaan</code> and <code>piecewiseSEM</code> are two of the most widely used and accessible packages for latent variable modelling in R. Both use frequentist methods.</p>
<p>It is also possible to develop SEMs in a Bayesian framework. There are advantages to using the Bayesian framework. So here I provide a brief tutorial on creating a simple Bayesian SEM with the stan program.</p>
<p>The <a href="https://ecmerkle.github.io/blavaan/">blavaan</a> package creates and fits SEMs in a Bayesian framework, but using similar syntax to lavaan. But it can help your understanding to code your own models and give you greater flexibility (though blavaan can do a lot!).</p>
<p>The tutorial is based on our <a href="https://www.sciencedirect.com/science/article/pii/S0048969723002851">recent study</a> that sought to understand relationships among indicators of catchment and fishery condition. If you find the SEM methods described here useful, please cite the paper.</p>
<p>Code for that study, including a more complicated SEM, is available <a href="https://github.com/cbrown5/ecological-condition-latent-model">on the study’s github repo</a>.</p>
<p>I won’t cover much SEM theory or background on Bayesian modelling. For more info on those topics:</p>
<ul>
<li><p>A introduction to SEM theory, check out <a href="https://jslefche.github.io/sem_book/">Jon Lefcheck’s online book</a></p></li>
<li><p><a href="https://mc-stan.org/users/documentation/tutorials">rstan documentation and tutorials</a></p></li>
<li><p>Learn Bayesian stats with the The Statistical Rethinking <a href="https://xcelab.net/rm/statistical-rethinking/">book</a> and <a href="https://www.youtube.com/watch?v=cclUd_HoRlo">Youtube series</a></p></li>
</ul>
</section>
<section id="advantages-of-bayesian-sem" class="level2">
<h2 class="anchored" data-anchor-id="advantages-of-bayesian-sem">Advantages of Bayesian SEM</h2>
<p>The key advantage is the flexibility Bayesian methods give you. We used Bayesian methods because we wanted to combine a state-space model and a SEM. The state-space model was a timeseries model of fish population change through time.</p>
<p>The population model was linked to a latent (unobserved) variable that represented cathcment condition. Other observed indicators of catchment condition were pasture biomass and vegetation greenness.</p>
<p>Other applications of Bayesian SEM could be to model non-gaussian data, incorporating spatial and temporal models into a SEM, or modelling missing data.</p>
<p>Now we’ll step through a broad overview of how to get started with Bayesian SEM. We’ll use the data from my paper as an example.</p>
<p><a href="https://github.com/cbrown5/ecological-condition-latent-model/blob/main/Data%20for%20Barramundi%20model.csv">Download the data</a></p>
</section>
<section id="define-your-dag-directed-acyclical-graph" class="level2">
<h2 class="anchored" data-anchor-id="define-your-dag-directed-acyclical-graph">Define your DAG (directed acyclical graph)</h2>
<p>SEMs need to be directed acyclical graphs. The DAG defines the proposed relationships among variables. It is the starting point for writing the math that describes the model.</p>
<p>We’ll define a simple DAG that aligns to a factor analysis. We’ll model relationships between streamflow, fish (barramundi) catch per unit effort (CPUE) and vegetation greenness (NDVI) for a catchment in Northern Australia:</p>
<pre><code>library(dagitty)
library(ggdag)
dag1 &lt;- dagify(CPUE ~ LV, 
               NDVI ~ LV,
               SF ~ LV)
ggdag(dag1)</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-1-1.png" class="img-fluid"></p>
<p>Our observed indicators are SF (streamflow), NDVI (veg greeness) and CPUE (catch per unit effort). LV is a latent variable that represents correlations among the observed variables.</p>
<p>This system is strongly driven by rainfall and river flow, so we expect positive correlations among flow, fish and vegetation.</p>
</section>
<section id="define-the-stan-model" class="level2">
<h2 class="anchored" data-anchor-id="define-the-stan-model">Define the stan model</h2>
<p>Now we have a DAG, we need to write equations to represent the proposed relationships. We also need to specify the priors.</p>
<p>Here I’m assuming normal distributions for each variable (logging for CPUE). Priors are weakly informative to encourage convergence.</p>
<p>I won’t include the full stan model definition below, just the model component. <a href="https://github.com/cbrown5/ecological-condition-latent-model/blob/main/simple-model.stan">Click here to download the full model file you’ll need to run this</a>.</p>
<p>Here’s the core of the model:</p>
<pre><code>cfa_mod &lt;- "model{ 

  //
  //Ecological condition 
  //
  nu ~ std_normal(); 
  //Note variance fixed to 1 by using standard normal here
  
  //Priors for indiator params 
  a_NDVI ~ normal(0,10);
  a_CPUE~ normal(0,10);
  a_SF ~ normal(0,10);
  
  beta_NDVI ~ normal(0,1);
  beta_CPUE ~ normal(0,1);
  beta_SF ~ exponential(1.8);
  //Note use of exponential() for streamflow to ensure positive
  // only values. Helps convergence. 
  
  //Observation errors
  sigma_CPUE ~  exponential(0.1);
  sigma_NDVI ~  exponential(0.1);
  sigma_SF ~  exponential(0.1);
  
  // Observations
  lnCPUE ~ normal(lnCPUE_hat, sigma_CPUE);
  NDVI ~ normal(NDVI_hat, sigma_NDVI);
  SF ~ normal(SF_hat, sigma_SF);
}"</code></pre>
<p>Read in the full model file and compile it for stan:</p>
<pre><code>library(rstan)

mod &lt;- stan_model(file = "simple-model.stan", verbose = FALSE)</code></pre>
<p>At this point there is usually a fair bit of debugging and fixing of typos until the model parses correctly.</p>
</section>
<section id="consider-identifiability" class="level2">
<h2 class="anchored" data-anchor-id="consider-identifiability">Consider identifiability</h2>
<p>Identifiability is a common issue in SEM. Roughly it means that some of the free parameters you are trying to estimate are interchangeable. Therefore, even with an infinite amount of data you would be unable to identify their values precisely (e.g.&nbsp;one could be high the other low or vice-versa).</p>
<p>A basic example would be the model:</p>
<p><code>y = a*x + b*x + c</code></p>
<p>parameters <code>a</code> and <code>b</code> are interchangeable.</p>
<p>Identifiability is a bit different in Bayesian models, because we have priors. For instance, in the model above, if we set a very strong priors on <code>a</code> and/or <code>b</code> (based on theory for instance) we may still be able to estimate their values precisely.</p>
<p>In a complex SEM issues of identifiability can be much harder to distinguish than the example above, as we will see.</p>
<p>Identifiability issues in a Bayesian will manifest as poor convergence of MCMC chains. You will see high Rhats. Digger deeper you may find some parameters have bimodal posterior distributions (e.g.&nbsp;if you do a histogram of all samples for a parameter). You will also find strong correlations in parameter estimates. For instance in the model above parameters <code>a</code> and <code>b</code> would be strongly correlated (near 1).</p>
<p>You may be able to get convergence if you run your model for really long chains, however, it will be more efficient to try and fix the model. It will also mean your parameters are easier to interpret.</p>
<p>If you have identifiability issues, parameters that have the property above are a good place to start to try to fix issues in your SEM formulation.</p>
<p>In the stsan code above I’ve made two key decisions to facilitate convergence.</p>
<p>First, I’ve fixed the latent standard deviation to 1 to ensure identifiability. You could also have the latent’s SD free, but then fix one of the regression slopes to 1.</p>
<p>Second, I’ve set the prior for the streamflow beta (regression slope on the latent variable) to be an exponential. This ensures it has only positive values.</p>
<p>For example, imagine that streamflow, NDVI and CPUE are all positively correlated with each other. Then their beta’s all need to be the same sign. However, they could equally well be all positive, or all negative. The meaning is the same, since the latent variable has not units.</p>
<p>If we run the model where all betas are sampled from normal priors, then we would hit issues with parameter switching. We see strong bimodality in the posteriors for the betas, because they can equally well be all positive or all negative. This slows converngence significantly.</p>
<p>So instead I’ve used an <code>exponential(1.8)</code> prior for the streamflow beta. This peg the sign to whatever streamflow is doing. So if streamflow is positive and the other covariates are positively associated with it, they will all have positive betas.</p>
<p>I chose <code>1.8</code> so that my prior has similar 90th percentile as a normal distribution. e.g.&nbsp;compare <code>qnorm(0.9, 0,1)</code> to <code>qexp(0.9, 1.8)</code> both have 90th percentiles at about 1.28.</p>
</section>
<section id="do-some-data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="do-some-data-cleaning">Do some data cleaning</h2>
<p>Now let’s get the data and just clean it up a bit.</p>
<pre><code>dat &lt;- read.csv("Data for Barramundi model.csv")</code></pre>
<p>First calculate the log of the CPUE:</p>
<pre><code>dat$lnCPUE &lt;- log(dat$Barramundicatch/dat$Effort)</code></pre>
<p>Some variables are missing data. In our paper I modelled missing data, but here we will just use years with complete data for simplicity:</p>
<pre><code>dat2 &lt;- subset(dat, Year %in% 1995:2015)</code></pre>
<p>Now we will standardize and centre each variable, makes it easier to set priors and interpret the regression coefficients (AKA loadings). We’ll also define a list to use in the stan model</p>
<pre><code>datstan &lt;- with(dat2, {
  x = list(N = nrow(dat2),
       SF = (Streamflow - mean(Streamflow))/sd(Streamflow), 
       NDVI = (NDVI - mean(NDVI))/sd(NDVI), 
       lnCPUE = (lnCPUE - mean(lnCPUE))/sd(lnCPUE)
  )})</code></pre>
</section>
<section id="fit-the-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-model">Fit the model</h2>
<p>Now we are ready to fit the stan model:</p>
<pre><code># options(mc.cores = 1) #parallel::detectCores())

fitm1 &lt;- sampling(mod, data = datstan,
               iter=8000, chains=3, thin = 10)</code></pre>
</section>
<section id="investigate-convergence" class="level2">
<h2 class="anchored" data-anchor-id="investigate-convergence">Investigate convergence</h2>
<p>For this task I recommend launching the shiny tool for exploring stan fits. Can be done like this:</p>
<pre><code>shinystan::launch_shinystan(fitm1)</code></pre>
<p>If convergence is poor (e.g.&nbsp;higher Rhat values or strong autocorrelation in the chains) a good place to start in a SEM is to check for parameter non-identifiability, as described above. This means some parameters are interchangeable (or nearly so).</p>
<p>A handy way to explore for the above issues is to click the “Explore” tab in the shiny, then do bivariate plots of parameters against each other.</p>
<p>The histograms for this model fit look like they’ve converged on a unimodal distribution:</p>
<pre><code>samps &lt;- extract(fitm1)

par(mfrow = c(1,3))
hist(samps$beta_NDVI)
hist(samps$beta_CPUE)
hist(samps$beta_SF)</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-11-1.png" class="img-fluid"></p>
</section>
<section id="explore-model-results" class="level2">
<h2 class="anchored" data-anchor-id="explore-model-results">Explore model results</h2>
<p>For this model the regression slopes (AKA factor loadings) are of primary interest. They tell us how the different indicators are related to each other.</p>
<p>Make a dataframe of the samples of interest:</p>
<pre><code>fit_dat &lt;- with(samps, data.frame(beta_SF, beta_NDVI, beta_CPUE))</code></pre>
<p>Now use tidyr to reshape for easy plotting:</p>
<pre><code>library(tidyr)
library(dplyr)
fittidy &lt;- fit_dat %&gt;% 
  mutate(sample = 1:nrow(fit_dat)) %&gt;%
  pivot_longer(-sample, names_to = "Parameter", values_to = "value")</code></pre>
<p>Now use ggplot to plot posterior distributions</p>
<pre><code>library(ggplot2)
theme_set(theme_classic())
ggplot(fittidy) + 
  aes(x = value, y = Parameter, fill = Parameter) + 
  geom_vline(xintercept = 0) + 
  geom_violin()</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-14-1.png" class="img-fluid"></p>
<p>All have positive values, indicating all indicators are positively associated with each other.</p>
</section>
<section id="check-model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="check-model-assumptions">Check model assumptions</h2>
<p>We need to check assumptions like any regular model. This means checking distributions are appropriate to model the data, same as you would for any GLM.</p>
<p>In a SEM we also have to think about d-separation. In short, this means checking for residual correlations between a our variables that aren’t explicitly part of the model.</p>
<p><a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/11-1899.1">There’s formal tests of d-separation for Bayesian models</a>, but <a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/15-0833.1">many authors have just used visual checks of residual correlations</a>.</p>
<p>There are many resources on d-separation, <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1890/08-1034.1">here’s one paper</a>. Books by Judea Pearl and Bill Shipley are also good ways to learn.</p>
<p>Our data here also has the additional complexity of being time-series. Our model above assumes d-separation of a variable from itself through time, so this is also something we could check (by testing for autocorrelation in the residuals).</p>
<p>I won’t show all these tests in this brief tute, but here’s a start on getting residuals. Just subtract the predictions from the observations, e.g.&nbsp;for NDVI:</p>
<pre><code>med &lt;- apply(samps$NDVI_pred, 2, median)
resids &lt;- datstan$NDVI - med</code></pre>
<p>One way to check the normal distribution is appropriate for the NDVI data is to do a quantile-quantile plot of the residuals:</p>
<pre><code>qqnorm(resids)
qqline(resids)</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-16-1.png" class="img-fluid"></p>
<p>We want to see the points fall close to straight on the line, which in general they do.</p>
<p>We can also check for non-linearities by plotting observations vs predictions:</p>
<pre><code>plot(med, datstan$NDVI)</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-17-1.png" class="img-fluid"></p>
<p>Of course this is Bayesian analysis, so we could also create credible intervals for the residuals.</p>
<p>If you do the above for CPUE you’ll see there is clearly strong autocorrelation. This is one reason I used a <a href="https://www.sciencedirect.com/science/article/pii/S0048969723002851">state-space model in the paper</a>.</p>
</section>
<section id="graph-model-results" class="level2">
<h2 class="anchored" data-anchor-id="graph-model-results">Graph model results</h2>
<p>Let’s make a plot of the result. First we’ll get median effect sizes (just the median of the chains for each parameter)</p>
<pre><code>meds &lt;- round(apply(fit_dat, 2, median),2)</code></pre>
<p>Now we can make the plot with labels on the arrows. Most of this code is just setting up the position of things:</p>
<pre><code>dag1 &lt;- dagify(CPUE ~ LV, 
               NDVI ~ LV,
               SF ~ LV)
coords &lt;- list(x = c(CPUE = -1, NDVI = 0, SF = 1, LV = 0),
               y = c(CPUE = 1, NDVI = 1, SF = 1, LV = 0))
coordinates(dag1) &lt;- coords
ggdag(dag1) +
  annotate("text", x = c(-0.6, 0.1, 0.6), y = c(0.5, 0.5, 0.5),
           label = meds) +
  lims(y = c(-0.5, 1.5))</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-19-1.png" class="img-fluid"> As its a Bayesian analysis we could also add CIs or probability that an effect is &gt;0. They could be calculated like this.</p>
<p>e.g.&nbsp;upper 95th quantile:</p>
<pre><code>round(apply(fit_dat, 2, quantile, 0.975),2)

##   beta_SF beta_NDVI beta_CPUE 
##      1.27      1.21      1.13</code></pre>
<p>Or probability effect is greater than zero:</p>
<pre><code>nsamps &lt;- nrow(fit_dat)
round(apply(fit_dat, 2, function(x){sum(x&gt;0)/nsamps}),2)

##   beta_SF beta_NDVI beta_CPUE 
##      1.00      1.00      0.98</code></pre>
</section>
<section id="model-predictions" class="level2">
<h2 class="anchored" data-anchor-id="model-predictions">Model predictions</h2>
<p>Our model also predicts the mean for each variable. Let’s just look at CPUE. In this matrix rows are samples are columns are years. So we can summarize each column to get the prediction with intervals for that year.</p>
<p>Here is the median with 90th credible intervals and data shown as points:</p>
<pre><code>ndvi_pred &lt;- data.frame(year = dat2$Year, 
                        ndvi_obs = datstan$NDVI, 
                        med = apply(samps$NDVI_pred, 2, median),
                        lwr = apply(samps$NDVI_pred, 2, quantile, 0.05),
                        upr = apply(samps$NDVI_pred, 2, quantile, 0.95))

ggplot(ndvi_pred) + 
  aes(x = year, y = med) +
  geom_line() + 
  geom_ribbon(aes(ymin = lwr, ymax =upr), color = NA, 
                 fill = "black", alpha = 0.5) +
  geom_point(aes(y = ndvi_obs)) +
  labs(x = "Year", y = "NDVI (normalized)")</code></pre>
<p><img src="2023-06-15-bayesian-sem-tute/unnamed-chunk-22-1.png" class="img-fluid"></p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Bayesian modelling is a powerful framework for building SEMs. It gives you greater flexibility in developing models than the standard SEM R packages.</p>
<p>You can use all types of non-gaussian distributions to model data, as well as build in other model types like non-linear or state-space models.</p>
<p>The cost is an extra overhead to learn the theory of SEM and the methods for Bayesian modelling. But if you have a background in one or the other, and some programming ability, then it won’t be too hard.</p>
<p>I learned Bayesian modelling well before I started on SEMs. When I came to SEM (through the lavaan package) I was overwhelmed and confused by jargon and interpretation of greek letters that have a special meaning to SEM specialists. I found it much easier to gain a high level understanding of SEM issues (like d-seperation) then work in the Bayesian framework to build models.</p>
<hr>
</section>
<section id="post-2017-06-21-bayesian-smoothing" class="level2">
<h2 class="anchored" data-anchor-id="post-2017-06-21-bayesian-smoothing">POST: 2017-06-21-bayesian-smoothing</h2>
<p>Path: posts/2017-06-21-bayesian-smoothing/index.md</p>
<p>Recently I looked at <a href="../rstats/2017/06/18/estimating-popn-decline.html">fitting a smoother to a time-series</a> using Bayesian modelling. Now I will look at how you can control the smoothness by using more or less informative priors on the precision (1/variance) of the random effect.</p>
<p>We will use the <a href="../rstats/2017/06/18/estimating-popn-decline.html">same dataset as the last post</a>.</p>
<p>To control the priors for an <a href="http://www.r-inla.org/">R-INLA</a> model, we use the <code>hyper</code> argument (not hyperactive, but hyper-parameters):</p>
<pre><code>library(INLA)
f3 &lt;- y ~ 1 + f(z, model = "rw1", scale.model = TRUE,
hyper = list(theta = list(prior="pc.prec", param=c(1,0.01))))</code></pre>
<p>We can control the level of smoothing through <code>param=c(theta1,0.01)</code>. A value of 1 (theta1) is a reasonable starting point (<a href="http://www.math.ntnu.no/inla/r-inla.org/doc/latent/rw1.pdf">based on the INLA documentation</a>). Lower values will result in a smoother fit.</p>
<p>The <code>pc.param</code> stands for Penalized complexity parameters (you could also use a <code>loggamma</code> prior here). My understanding of <a href="https://arxiv.org/abs/1403.4630">penalized complexity priors</a> is that they shrink the parameter estimate towards a ‘base-model’ that is less flexible. In this case, we are shrinking the standard deviation (AKA the flexibility) of the random walk (ie how much sequential data points deviate from each other) towards zero. Ultimately if we set theta1 near zero the smoother will be a straight line.</p>
<p>So let’s fit three models with theta1 varying and see how it affects the smoothness of the fit:</p>
<pre><code>f1 &lt;- y ~ 1 + f(z, model = "rw1", scale.model = TRUE,
hyper = list(theta = list(prior="pc.prec", param=c(0.01,0.01))))

f2 &lt;- y ~ 1 + f(z, model = "rw1", scale.model = TRUE,
hyper = list(theta = list(prior="pc.prec", param=c(0.05,0.01))))

f3 &lt;- y ~ 1 + f(z, model = "rw1", scale.model = TRUE,
hyper = list(theta = list(prior="pc.prec", param=c(1,0.01))))

m1 &lt;- inla(f1,family = "nbinomial", data  =  dat,
    control.predictor = list(compute = TRUE, link = 1)
)

m2 &lt;- inla(f2,family = "nbinomial", data  =  dat,
    control.predictor = list(compute = TRUE, link = 1)
)

m3 &lt;- inla(f3,family = "nbinomial", data  =  dat,
    control.predictor = list(compute = TRUE, link = 1)
)</code></pre>
<p>Here are the resulting fits:</p>
<pre><code>plot(dat$z, dat$y, col = 'grey80', type = 'l', lwd = 1, xlab = "years", ylab = "Abundance", las = 1)

lines(dat$z, m1$summary.fitted.values$mean, col = "skyblue", lwd = 2)
lines(dat$z, m2$summary.fitted.values$mean, col = "steelblue", lwd = 2)
lines(dat$z, m3$summary.fitted.values$mean, col = "darkblue", lwd = 2)

legend('topright', legend = c("data", "theta1 = 0.01", "theta1 = 0.05", "theta1 = 1"),
      lty = 1, col = c("grey80", "skyblue", "steelblue", "darkblue"), lwd = 2)</code></pre>
<p><img src="bayesian-smoothing_files/fitted-models-vary-theta-1.png" class="img-fluid"></p>
<p>The exact value to use for theta1 will vary depending on our data. If the data are more informative (e.g.&nbsp;a longer time-series) we will have to use a smaller value to create a smoother fit.</p>
<pre><code>dat2 &lt;- list(y = dat$y[1:40], z = 1:40)
m4 &lt;- inla(f2,family = "nbinomial", data  =  dat2,
    control.predictor = list(compute = TRUE, link = 1)
)
plot(dat$z, dat$y, col = 'grey80', type = 'l', lwd = 1, xlab = "years", ylab = "Abundance", las = 1)

lines(dat$z, m2$summary.fitted.values$mean, col = "skyblue", lwd = 2)
lines(dat2$z, m4$summary.fitted.values$mean, col = "steelblue", lwd = 2)

legend('topright', legend = c("data", "theta1 = 0.05, 50 data points", "theta1 = 0.05, 40 data points"),
      lty = 1, col = c("grey80", "skyblue", "steelblue"), lwd = 2)</code></pre>
<p><img src="bayesian-smoothing_files/fitted-models-vary-n-1.png" class="img-fluid"></p>
<p>And that is pretty much it. I haven’t read how to choose the ‘optimal’ value of theta. Pragmatically, one could do it with cross validation or perhaps a model selection measure. However, that seems philosophically incorrect, because it is a ‘prior’. There doesn’t seem to be much guidance in the literature about how to choose priors for smoothing. Message me on <a href="https://twitter.com/bluecology/">Twitter</a> if you have seen an example of doing this.</p>
<p>It is amazing to see how the use of priors in statistics has changed since I first learned about Bayesian statistics. It used to be that you would use informative priors only if you had strong prior beliefs about a parameter estimate, such as from expert elicitation, or repeat experiments. If you didn’t have strong prior beleifs, then the view (at least amongst many ecologists) was that it was most cautious to use a highly uninformative prior like the good old Winbugs gamma(0.01, 0.01) prior that was used for precision parameters.</p>
<p>Now the experts are encouraging us to use weakly informative priors, even when little prior evidence is available. The case being that too broad a prior can slow computations and result in ridiculous results. Consider the broad gamma(0.01, 0.01) prior: it amounts to giving equal weight to a standard deviation of 1 as it does to an SD of 10000. The end result is that this ‘uninformative prior’ can bias your estimates of the SD to be too high.</p>
<p>As demonstrated here, another nice feature of informative priors is they can be used to control ‘shrinkage’. Here by varying theta1 we could shrink our model fit towards a base case model (e.g.&nbsp;a null hypothesis) that had no temporal variation.</p>
<p>If you are interested to learn more, it is worth reading at least the Introduction of <a href="https://arxiv.org/abs/1403.4630">Simpson et al.&nbsp;Penalized Complexity Priors pub</a>. Other good general guidance can be found on the <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">STAN wiki</a>.</p>
<p>There is clearly a lot more fun we can have by playing around with priors. I anticipate that applied scientists, like my ecological colleagues, will soon start paying much more attention to prior choice.</p>
<hr>
</section>
<section id="post-2020-04-21-a-case-against-pipes" class="level2">
<h2 class="anchored" data-anchor-id="post-2020-04-21-a-case-against-pipes">POST: 2020-04-21-a-case-against-pipes</h2>
<p>Path: posts/2020-04-21-a-case-against-pipes/index.md</p>
</section>
</section>
<section id="a-case-against-pipes-in-r-and-what-to-do-instead" class="level1">
<h1>A case against pipes in R and what to do instead</h1>
<p>Pipes (<code>%&gt;%</code>) are great for improving readibility of lengthy data processing scripts, but I’m beggining to learn they have some weaknesses when it comes to large and complex data processing.</p>
<p>We are running a number of projects at the moment that require managing and wrangling large and complex datasets. We have numerous scripts we use to document our workflow and the data wrangling steps. This has turned out to be very helpful, because when we identify bugs in the end product, we can go back and fix them.</p>
<p>But I’m starting to see a pattern. Most of the really insidious bugs occur in sections of code that use <code>dplyr</code> tools and pipes. These are always the types of bugs that don’t throw an error, so you get a result, it just turns out to be wrong. They are the worst kind of bugs. And hard to detect and fix.</p>
<p>So we are now moving away from using pipes in complex scripts. For simple scripts I intend to keep using them, they are so fast and easy. Here’s what we’re trying instead.</p>
<section id="the-problem-with-pipes" class="level2">
<h2 class="anchored" data-anchor-id="the-problem-with-pipes">The problem with pipes</h2>
<p>So here’s some made up data that mimics the kind of fish survey data we often have:</p>
<pre><code>sites &lt;- data.frame(site = letters[1:5],
                    temp = rnorm(5, 25, 2), stringsAsFactors = FALSE)
dat &lt;- expand.grid(site = letters[1:5],
                   transect = 1:4)
dat$abundance &lt;- rpois(20, 11)</code></pre>
<p>So we have site level data with a covariate, <code>temp</code> and transect level data with fish counts.</p>
<p>Now say we have an error and one of our sites has capitals, instead of lower case, so lets introduce that bug:</p>
<pre><code>sites$site[1] &lt;- "A"</code></pre>
<p>Now if I join and summarize them, I will lose one of the sites</p>
<pre><code>library(dplyr)

## Warning: package 'dplyr' was built under R version 3.6.3

##
## Attaching package: 'dplyr'

## The following objects are masked from 'package:stats':
##
##     filter, lag

## The following objects are masked from 'package:base':
##
##     intersect, setdiff, setequal, union

dat %&gt;%
  inner_join(sites) %&gt;%
  group_by(site) %&gt;%
  summarize(mean(abundance))

## Joining, by = "site"

## Warning: Column `site` joining factor and character vector, coercing into
## character vector

## # A tibble: 4 x 2
##   site  `mean(abundance)`
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 b                   9  
## 2 c                  12  
## 3 d                  12.5
## 4 e                  12.8</code></pre>
<p>Obvious enough here, but issues like that are much harder to detect in very large datasets.</p>
</section>
<section id="unit-testing" class="level2">
<h2 class="anchored" data-anchor-id="unit-testing">Unit testing</h2>
<p>The solution of course is to code in ‘unit tests’ to make sure each operations are doing what you expect. For small data you can just look, but for big datasets its not so easy.</p>
<p>For long pipes with multiple steps we’d usually do this debugging and testing interactively. So I’d write the first line (the join) save the output to a new variable, check it worked ok, then move on to write the next step of the pipe.</p>
<p>Now here’s the catch. In complex project its common to change the data that goes into your pipe (in this case <code>dat</code> or <code>sites</code> dataframes). For instance, in our current project new data comes in all the time.</p>
<p>New data presents new issues. So a pipe that worked the first time may no longer work the second time.</p>
<p>This is why it is crucial to have unit tests <strong>built into your code</strong>.</p>
<p>There are lots of sophisticated R packages for unit testing, including ones that work with pipes. But given many of us are just learning tools like <code>dplyr</code> its not wise to add extra tools. So here I’ll show some simple unit tests with base R.</p>
</section>
<section id="unit-testing-an-example" class="level2">
<h2 class="anchored" data-anchor-id="unit-testing-an-example">Unit testing an example</h2>
<p>Joins often case problems, due to mis-matching (e.g.&nbsp;if site names are spelt differently in different datasets, which is a very common human data entry error!).</p>
<p>So its wise to check the join has worked. Here’s some examples:</p>
<pre><code>dat2 &lt;- inner_join(dat, sites)

## Joining, by = "site"

## Warning: Column `site` joining factor and character vector, coercing into
## character vector</code></pre>
<p>Now compare number of rows:</p>
<pre><code>nrow(dat2)

## [1] 16

nrow(dat)

## [1] 20</code></pre>
<p>Obviously the join has lost data in this case.</p>
<p>We can do better though with a complex script. We’d like to have an error if the data length changes. We can do this:</p>
<pre><code>nrow(dat2) == nrow(dat)

## [1] FALSE</code></pre>
<p>Which tells us TRUE/FALSE if the condition is met. To get an error use <code>stopifnot</code></p>
<pre><code>stopifnot(nrow(dat2) == nrow(dat))</code></pre>
</section>
<section id="common-unit-tests-for-data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="common-unit-tests-for-data-wrangling">Common unit tests for data wrangling</h2>
<p>Let’s start with the basics. No special packages, just simple logical queries.</p>
<p>Of the top of my head here are a few of my most commonly used unit tests To check the number of sites has stayed the same, use <code>length(unique(</code>… to get the number of unique cases:</p>
<pre><code>length(unique(dat$site))

## [1] 5

length(unique(dat2$site))

## [1] 4

length(unique(dat$site)) == length(unique(dat2$site))

## [1] FALSE</code></pre>
<p>Or if we wanted to compare the <code>site</code> and <code>dat</code> dataframes:</p>
<pre><code>unique(sites$site) %in% unique(dat$site)

## [1] FALSE  TRUE  TRUE  TRUE  TRUE</code></pre>
<p>The <code>%in%</code> just means are the sites names in <code>sites</code> matching the site names in <code>dat</code>? (We can use <code>stopifnot</code> here too, with multiple TRUE/FALSE values).</p>
<p>How many don’t match?</p>
<pre><code>sum(!(unique(sites$site) %in% unique(dat$site)))

## [1] 1</code></pre>
<p>The <code>!</code> is a logical ‘not’ (not FALSE = TRUE, so we are counting non-matches).</p>
<p>Which one doesn’t match?</p>
<pre><code>sites$site[!unique(sites$site) %in% unique(dat$site)]

## [1] "A"</code></pre>
<p>Here’s another insidious bug caused by joins, when our covariate dataframe has duplicate site entries:</p>
<pre><code>sites &lt;- data.frame(site = c(letters[1:5], "a"),
                    temp = c(rnorm(5, 25, 2), 11), stringsAsFactors = FALSE)
sites

##   site     temp
## 1    a 19.30061
## 2    b 23.76530
## 3    c 24.89018
## 4    d 25.16386
## 5    e 23.83092
## 6    a 11.00000</code></pre>
<p>Now we have two sites called <code>a</code> with different values of <code>temp</code>. Check out the join:</p>
<pre><code>dat2 &lt;- inner_join(dat, sites)

## Joining, by = "site"

## Warning: Column `site` joining factor and character vector, coercing into
## character vector

nrow(dat)

## [1] 20

nrow(dat2)

## [1] 24</code></pre>
<p>So its added rows, ie made up data we didn’t have. Why? Well the join duplicated all the site <code>a</code> values for both values of temp:</p>
<pre><code>filter(dat2, site == "a")

##   site transect abundance     temp
## 1    a        1        10 19.30061
## 2    a        1        10 11.00000
## 3    a        2        11 19.30061
## 4    a        2        11 11.00000
## 5    a        3        12 19.30061
## 6    a        3        12 11.00000
## 7    a        4         9 19.30061
## 8    a        4         9 11.00000</code></pre>
<p>No watch this, we can really go wrong when we summarize:</p>
<pre><code>dat2 %&gt;%
  group_by(site) %&gt;%
  summarize(sum(abundance))

## # A tibble: 5 x 2
##   site  `sum(abundance)`
##   &lt;chr&gt;            &lt;int&gt;
## 1 a                   84
## 2 b                   36
## 3 c                   48
## 4 d                   50
## 5 e                   51</code></pre>
<p>It looks like site <code>a</code> has twice as many fish as it really does (78, when it should have 39). So imagine you had a <code>site</code> dataframe you were happy worked, then your collaborator sent you a new one to use, but it had duplicate rows. If you didn’t have the unit test to check your join in place, you may never know about this doubling of data error.</p>
<p>We could check for this by checking for the number of transects e.g.</p>
<pre><code>dat_ntrans &lt;- dat2 %&gt;% group_by(site) %&gt;% summarize(n = n())
dat_ntrans

## # A tibble: 5 x 2
##   site      n
##   &lt;chr&gt; &lt;int&gt;
## 1 a         8
## 2 b         4
## 3 c         4
## 4 d         4
## 5 e         4

dat_ntrans$n != 4

## [1]  TRUE FALSE FALSE FALSE FALSE</code></pre>
<p>(Yes I used a pipe this time, but a simple one).</p>
</section>
<section id="more-sophisticated-method-for-unit-testing" class="level2">
<h2 class="anchored" data-anchor-id="more-sophisticated-method-for-unit-testing">More sophisticated method for unit testing</h2>
<p>(This part is new as of 2020-04-22)</p>
<p>So once this post got shared I got a lot of feedback. A lot of lovely people wrote me with the timeless rstats cliche “there’s a package for that” (I say that being an abuser of that cliche myself).</p>
<p>So if you really want to get into unit testing and take it to the next level here’s a few of the tips I received.</p>
<p>Roger Bivand wrote to tell me about <a href="https://cran.r-project.org/web/packages/validate/vignettes/introduction.html">validate package</a>, which comes with a <a href="https://cran.r-project.org/doc/contrib/de_Jonge+van_der_Loo-Introduction_to_data_cleaning_with_R.pdf">whole book in pdf format</a> on data cleaning (that is now on my ‘lockdown’ reading list).</p>
<p>Another popular one is <a href="https://cran.r-project.org/web/packages/testthat/index.html">testthat</a>, which I received many recommendations for (haven’t used it myself).</p>
<p>Ed Hagen shared <a href="https://github.com/elbersb/tidylog/">tidylog</a> that conveniently prints messages telling you what join and so on have done did (pretty low overhead on learning this one!). Might be good package to install if you are just learning dplyr too, as it reveals more about what is going on.</p>
<p>David Aja and others messaged me about <a href="https://github.com/rich-iannone/pointblank">point blank</a>, which integrates unit testing into pipes.</p>
<p>These are all great solutions for the advanced R user. My challenge with them is that students get worn down by hearing “there’s another R package for that”. So best solution is take it step-by-step, get some simple unit testing going first. If that’s not enough to get the job done, then start using these tools, once you’re comfortable with the basics.</p>
</section>
<section id="going-forward" class="level2">
<h2 class="anchored" data-anchor-id="going-forward">Going forward</h2>
<p>So I plan on keeping up pipes, but just for simple things. For complex scripts we’ll break the pipes with more intermediate tests and do more unit testing. It’ll save a lot of pain down the road.</p>
<hr>
</section>
<section id="post-2017-03-29-locator-to-clipboard" class="level2">
<h2 class="anchored" data-anchor-id="post-2017-03-29-locator-to-clipboard">POST: 2017-03-29-locator-to-clipboard</h2>
<p>Path: posts/2017-03-29-locator-to-clipboard/index.md</p>
</section>
<section id="a-fast-method-to-add-annotations-to-a-plot" class="level2">
<h2 class="anchored" data-anchor-id="a-fast-method-to-add-annotations-to-a-plot">A fast method to add annotations to a plot</h2>
<p>Making professional looking plots in R can be fiddly. One task that I often spend ages doing is manually finding coordinates to add labels. Wouldn’t it be nice if you could just send the coordinates directly to your text editor?</p>
<p>I did some searching and found on <a href="http://stackoverflow.com/questions/14547069/how-to-write-from-r-to-the-clipboard-on-a-mac">stackoverflow</a> that you can send R objects to the clipboard. So here is my solution using that trick.</p>
<div class="image_caption">
<img src="locator-plot.png" alt="" class="image_float">
<p>
Adding text to the right position on a plot can be a real hassle. Here I show how to use a simple function to click on a figurea and put coordinates onto your clipboard.
</p>
</div>
<p>You can get R to send data directly to the clipboard using the <code>pipe</code> command. Below is a little function I wrote that takes coordinates from <code>locator()</code> and sends them to your clipboard. Then you can just hit cmd-v to paste them into your text editor (nb I understand this may need some slight modifications to work on linux or windows, I use OSX):</p>
<pre><code>loccopy &lt;- function(n, digits = 2){
    data &lt;- locator(n)
    data &lt;- round(cbind(data$x, data$y), digits)
    clip &lt;- pipe("pbcopy", "w")
    write.table(data, file = clip, col.names = F, row.names = F)
    close(clip)
}</code></pre>
<p>Let’s test it out:</p>
<pre><code>set.seed(42)
plot(runif(100))
loccopy(1)</code></pre>
<p>Now hit cmd-v (or equivalent on your OS).</p>
<pre><code>69.23 0.84</code></pre>
<p>Let’s add a label using our fast method for coordinates:</p>
<pre><code>text(69.23, 0.84, "Unusual data point", pos =4, offset = 0)</code></pre>
<p>The <code>pos=4</code> and <code>offset=0</code> ensures that the text goes directly to the right of our coordinates.</p>
<p>That’s it. Hope it helps speed up your workflow.</p>
<hr>
</section>
<section id="post-2026-01-04-marine-seascape-restoration" class="level2">
<h2 class="anchored" data-anchor-id="post-2026-01-04-marine-seascape-restoration">POST: 2026-01-04-marine-seascape-restoration</h2>
<p>Path: posts/2026-01-04-marine-seascape-restoration/index.md</p>
<p>The sub-tidal (underwater) habitats of our coasts are rarely uniform. They are often mosiacs of many different types of habitats, and that’s the way animals like it.</p>
<p>For instance, the Great Barrier Reef is famous for being a living organism you can see from space. But there is a lot more to the reef than coral reefs. The reef ecosystem is an enormous mosaic of corals, sand, seagrass, sponges, mangroves and many other habitat habitats.</p>
<p>In fact, the area of seagrass meadows - which is just what it sounds like, underwater grass - in the Great Barrier Reef is greater than its area of coral reefs.</p>
<p>Many other coastal habitats are similarly patchy. Kelp forests are bordered by sand and seagrass, mangroves are interconnected with saltmarshes and coral reefs and seagrass is often patchy meadows interspersed by sand, rather than a continuous block.</p>
<p>Mosaics of habitats are like shops around a village town square. A village with just lolly shops would suit my children, but not many others. A village with cafes, flower shops, gift stores, stationary stores and others would draw in lots of different customers.</p>
<p>Similarly, diverse coastal habitat arrangements tend to support a greater diversity of animals than uniform blocks.</p>
<p>As animals move around these networks of habitats they also help make connections among them.</p>
<p><img src="seagrass-giantkelp1.jpeg" class="img-fluid"></p>
<p><strong>Image:</strong> Boundaries of different habitats, here a giant kelp grows next to a seagrass meadow near my home in Tasmania, are often popular with ocean animals. Photo by Chris Brown.</p>
<p>There are numerous examples. For example, one species of fish that rests on coral reefs during the day, swims to nearby areas to feed at night. In doing so, they transport nutrients (in the form of fish wee and poo) to areas nearby the reefs, benefiting other organisms.</p>
</section>
<section id="denmarks-coastal-habitat-mosaics" class="level2">
<h2 class="anchored" data-anchor-id="denmarks-coastal-habitat-mosaics">Denmark’s coastal habitat mosaics</h2>
<p>We are getting much better at successfully restoring some coastal habitats and seeing some great wins for ocean animals. But for this to really work for animals we need to restore mosaics of habitats, not just one habitat at time.</p>
<p>That’s why what they’ve done with habitat restoration in Denmark is really unique.</p>
<p>In Vejle Fjord government and scientists have been working together to restore seagrass, boulder reefs and mussel beds since 2019. Historically these habitats were abundant. But agricultural run-off and extraction of boulders has converted the system to one dominated by muddy sand (soft sediments).</p>
<p>To date, the restoration of the three habitats is extensive, about 22 football (soccer) fields worth of habitat.</p>
<p>This is a large area compared to your typical coastal restoration project. But, what is unique here is the restoration of multiple habitats in the same area.</p>
<p><img src="vejle-ford-restoration.jpeg" class="img-fluid"></p>
<p><strong>Image</strong> Map of the restoration site showing the different habitats that have been restored from <a href="https://doi.org/10.1002/eap.70163">Sievers et al.&nbsp;2025</a>.</p>
</section>
<section id="studying-the-how-restoration-of-seascapes-benefits-animals" class="level2">
<h2 class="anchored" data-anchor-id="studying-the-how-restoration-of-seascapes-benefits-animals">Studying the how restoration of seascapes benefits animals</h2>
<p>The mosiac of restoration sites created the opportunity to study how animals would respond to the new seascape.</p>
<p>My colleague, Michael Sievers, worked with the Danish restoration science tea to count fish, prawns and sea snails in the seagrass and nearby bare sediment. Their surveys of animals included areas of remaining natural seagrass, as well as seagrass that had been planted in the restoration efforts.</p>
<p>When Michael invited me to help with the data analysis I jumped at the chance. I specialize in statistics and data analysis, and the way the surveys were done here meant there was potential to ask some really interesting questions about restoration ecology.</p>
<p>Michael wanted to know how if the animals did better when seagrass restoration was near to the mussel and boulder reefs that had also been restored.</p>
<p>The surveys were done in restored seagrass at different distances from the boulder and mussel reefs. This meant we could use the statistics to see if seagrass restored close to boulder or mussel reefs was better for the animals that might move among those habitats.</p>
<p>So I built a models of how animal numbers in a single location changed with the amount of seagrass and the distance to the other habitats. The model is a mathematical equation that describes a relationship like ‘as seagrass area increase we see more baltic prawns’.</p>
<p>The equation is built using statistics and the data, so it represents the real trends in the data. That’s why the survey design with different distances to different habitats was key. The model only works if it can find trends in the data.</p>
<p>The seagrass meadows were also patchy, some were larger than others. So we could also use the data to ask if larger areas of seagrass were better for animals when compared to mosaics of seagrass and soft sediment.</p>
<p>We found seagrass specialist species, like periwinkles, preferred larger areas of seagrass close to mussel reefs. Other species, like juvenile flatfish, preferred soft sediment that was near to mussel reefs, so there were fewer of them at the seagrass restoration sites.</p>
<p>Finally, some species preferred mosaics. Pipefish, which are a like a long thin seahorse, preferred patchy mosiacs of seagrass and soft sediment.</p>
</section>
<section id="what-if-we-did-restoration-differently" class="level2">
<h2 class="anchored" data-anchor-id="what-if-we-did-restoration-differently">‘What if’ we did restoration differently</h2>
<p>The models let us ask ‘what if’ questions about different ways to arrange the restoration of coastal habitats.</p>
<p>We calculated how many animals there would be with different seagrass plantings. For instance, what if the seagrass was planted only near to boulder reefs? What if it was planted far away from boulder reefs? What if it was planted in a mosaic of patches?</p>
<p>We found the best arrangements were different for each type of animal. The seagrass specialists liked a lot of seagrass planted in patches with small areas of soft sediment between it, like a checkerboard.</p>
<p>The species caught by fisheries (brown shrimp and flatfish) did best with large patches of seagrass and large patches of soft sediment.</p>
<p>Our study shows there are benefits to restoring whole seascapes of habitats together. Going forward I hope it can provide a pathway and motivation for other places to tackle the challenge of restoring seascapes.</p>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading</h2>
<p>Michael’s study on animals at the Denmark restoration site https://doi.org/10.1002/eap.70163</p>
<p>Great Barrier Reef habitats https://www2.gbrmpa.gov.au/learn/fascinating-facts-about-great-barrier-reef</p>
<p>Seagrass on the reef https://www.sciencedirect.com/science/article/abs/pii/S0272771414002078</p>
<p>Linkages among coastal habitats https://www.nature.com/articles/s44183-024-00095-1</p>
<p>Example of connections: Benefits of fish poo for nearby ecosystems https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecs2.2225</p>
<hr>
</section>
<section id="post-2025-12-08-kelp-restoration-fisheries" class="level2">
<h2 class="anchored" data-anchor-id="post-2025-12-08-kelp-restoration-fisheries">POST: 2025-12-08-kelp-restoration-fisheries</h2>
<p>Path: posts/2025-12-08-kelp-restoration-fisheries/index.md</p>
<p>Kelp restoration is gaining <a href="https://kelpforestalliance.com/">global momentum</a> with recognition that we are losing kelp forests and the values they provide as habitat for biodiversity and supporting fisheries.</p>
<p>But questions remain. We wanted to know if restoring giant kelp forests boost productivity for commercially important species like abalone and rock lobster. We <a href="https://doi.org/10.1002/aqc.70242">explore this question in our new study</a>. (Free access version <a href="https://www.biorxiv.org/content/biorxiv/early/2024/12/20/2024.12.16.628810.full.pdf">here</a> or <a href="mailto:c.j.brown@utas.edu.au">email me</a> for a copy)</p>
<p>We took measurements of kelp growth from Tasmania’s East Coast and used them in models of ecosystems to study how gain kelp restoration could impact fisheries.</p>
<p>We found the productivity gains could be substantial.</p>
<p><img src="kelp-productvity-foodwebs.jpg" class="img-fluid"> <strong>Images</strong> Key findings</p>
</section>
<section id="why-giant-kelp-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-giant-kelp-matters">Why giant kelp matters</h2>
<p>Giant kelp <em>Macrocystis pyrifera</em> has largely disappeared from Tasmania’s east coast, replaced by the less productive <em>Ecklonia radiata</em>. The productivity difference between these two species is striking - giant kelp is approximately 40 times more productive than Ecklonia.</p>
<p>That extra productivity has to go somewhere. While we still need more research to fully understand the fate of giant kelp biomass, the evidence suggests it flows through the food web to support a wide range of species, including those important for fisheries.</p>
</section>
<section id="modelling-food-web-effects" class="level2">
<h2 class="anchored" data-anchor-id="modelling-food-web-effects">Modelling food web effects</h2>
<p>We used ecosystem models to trace how increased macroalgae productivity from giant kelp restoration moves through the food web. The model shows productivity flowing from the restored kelp to herbivores like abalone, then up through different predator-prey interactions to boost productivity across many species in the ecosystem.</p>
<p>The most confident results come from the productivity measurements themselves - based on extensive, long-term datasets comparing giant kelp and Ecklonia across different areas and seasons.</p>
<p>Then we use those data in the model to predict the effects of meeting Australia’s restoration targets for giant kelp (restore 30% of degraded habitats).</p>
<p>The model predicted improvements of fishery catch of 1-7%, depending on the species. This is a substantial improvement given the scale of the model is the entirety of Tasmania and the area of kelp restoration is relatively small compared to that total area.</p>
<p><img src="2023-11-13_kelp-forest.jpg" class="img-fluid"></p>
<p><strong>Image</strong> Giant kelp breaking up in later summer - its death and decomposition provides food to microbes that feeds energy into the local foodweb.</p>
</section>
<section id="what-the-models-dont-capture" class="level2">
<h2 class="anchored" data-anchor-id="what-the-models-dont-capture">What the models don’t capture</h2>
<p>Our model looked across all of Tasmania’s waters. Future improvements could study local changes in fishery productivity near to kelp forests. These are likely to be more substantial and could benefit fishers the most in those areas.</p>
<p>The models focused on overall ecosystem productivity gains, but giant kelp provides additional benefits not captured in these predictions. Restoring dense surface canopies creates more habitat and refuge for juvenile fish, which could lead to even higher increases in fish productivity than the models predict.</p>
</section>
<section id="from-global-goals-to-local-action" class="level2">
<h2 class="anchored" data-anchor-id="from-global-goals-to-local-action">From global goals to local action</h2>
<p>Our study demonstrates how global restoration targets can be translated into specific, outcome-based goals relevant to local communities. In Tasmania, the positive impacts of giant kelp restoration on kelp forest health and fisheries productivity align well with local values and needs.</p>
<p>Models are particularly valuable at this stage of kelp restoration because we’re still in the early phases of upscaling. In the absence of previous large-scale examples to learn from, models help set realistic expectations and make the case for restoration investments. Models like this help show how restoration has relevance to communities. Community groups are more likely to support restoration when expected outcomes are clear and relevant to their specific needs.</p>
<p>Giant kelp is worth restoring not just because it’s something we’ve lost, but because of the ecosystem-wide benefits it provides.</p>
<hr>
</section>
<section id="post-2022-02-25-ambitious-targets" class="level2">
<h2 class="anchored" data-anchor-id="post-2022-02-25-ambitious-targets">POST: 2022-02-25-ambitious-targets</h2>
<p>Path: posts/2022-02-25-ambitious-targets/index.md</p>
<p>Ambitious restoration of mangroves and seagrasses could lead to substantial recovery of these ecosystems <a href="https://www.cell.com/current-biology/fulltext/S0960-9822(22)00235-4">new research has found</a>.</p>
<p>Published in <a href="https://www.cell.com/current-biology/fulltext/S0960-9822(22)00235-4">Current Biology</a>, the study estimated potential recovery of mangroves and seagrass under a range of protection and restoration strategies for 2030, 2050 and 2070, milestone years for international biodiversity commitments, and beyond.</p>
<p>“Protection alone is unlikely to drive sufficient recovery,” said Dr Christina Buelow from the Global Wetlands Project and the Griffith University Coastal and Marine Research Centre.</p>
<p>“Our research suggests that if ambitious action is taken to both protect and restore, gains of up to 5% for mangroves and 35% for seagrasses could be achieved by 2050.</p>
<p>“There is an urgent need to halt and reverse loss of mangroves and seagrass to continue to benefit from the services these ecosystems provide to coastal communities, such as enhancing coastal resilience and contributing to climate stability.”</p>
<p>Conservation action is needed to maintain and recover mangrove and seagrass ecosystems world-wide, but until now the expected outcomes of different protection and restoration strategies has remained unclear.</p>
<p>“Pairing global observations of mangrove and seagrass coverage change through time with modelled changes we demonstrated that only protection and restoration combined can support substantial gains in coverage of these ecosystems into the future,” said Professor Rod Connolly, Director of the Coastal and Marine Research Centre and the Global Wetlands Project.</p>
<p>“Our research can be used to set global conservation targets for coastal ecosystem recovery that are not only scientifically-sound, but are also have the necessary ambition required to inspire coordinated international action,” he said.</p>
<p>Associate Professor Chris Brown, also from The Global Wetlands Project and the Coastal and Marine Research Centre, added that “we need to be really ambitious if we are going to fight climate change and save coastal ecosystems.”</p>
<p>“Imagine if we put the kind of effort we are putting into space programs into protecting the Earth’s ecosystems – that’s what I mean by being ambitious.</p>
<p>“We need to save Earth’s ecosystems from the unprecedented scale of human pressures they face and help secure the stable climate that humanity needs to thrive.</p>
<p>“Our research provides the scientific basis to predict the outcomes we can expect for these ecosystems if they are ambitious. We hope this helps motivate action towards international targets for ecosystem protection, such as the UN Sustainable Development Goals and the Post-2020 Global Biodiversity Framework, which envisions a future where humans live in harmony with nature.”</p>
<hr>
</section>
<section id="post-2018-09-29-r-courses-february-2019" class="level2">
<h2 class="anchored" data-anchor-id="post-2018-09-29-r-courses-february-2019">POST: 2018-09-29-R-courses-February-2019</h2>
<p>Path: posts/2018-09-29-R-courses-February-2019/index.md</p>
<p>This is an announcement of our next set of R courses. There are 4 separate courses taught over 5th-8th February 2019.</p>
<p>You can <a href="https://smp.uq.edu.au/event/session/5650">register with the Centre for Applications in Resource Management site at the University of Queensland</a>.</p>
<p>These R workshops are especially tailored for biology/ecology, but will be useful for anyone working in sciences. We often have people from other sciences, like medicine attend.</p>
<p>Location is at the Centre for Applications in Natural Resource Management, The University of Queensland in Brisbane Australia. Student discounts on course fees are available.</p>
<p>Presenters: Prof Anthony Richardson (UQ Centre for Applications in Natural Resource Mathematics), Associate Prof David Schoeman (University of the Sunshine Coast), Dr Chris Brown (Griffith University).</p>
<p>The Advanced R course is taught by Dr Bill Venables (CSIRO) and long-time R developer.</p>
<p>We provide comprehensive workshop notes, including basic theory, applied worked examples in biology/ecology, and solution code. Here is the course schedule for 2019. In 2019 we have added a whole day for graphics, especially the use of the ‘ggplot2’ R package for plotting complex datasets.</p>
</section>
<section id="introduction-to-r-1-day" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-r-1-day">INTRODUCTION to R (1 day)</h2>
<p>Getting data into R; Summary Statistics; Simple Graphics; Manipulating Data; Simple statistics</p>
</section>
<section id="intermediate-r-2-days" class="level2">
<h2 class="anchored" data-anchor-id="intermediate-r-2-days">INTERMEDIATE R (2 days)</h2>
<p>ANOVA; Regression; Model selection; GLMs for binary and count data; GAMS; TREEs; Clustering; Ordination</p>
</section>
<section id="ggplot-and-spatial-analysis-in-r-1-day" class="level2">
<h2 class="anchored" data-anchor-id="ggplot-and-spatial-analysis-in-r-1-day">ggplot and spatial analysis in R (1 day)</h2>
<p>Data wrangling; ggplot; Mapping; Spatial analysis</p>
<p>This workshop is for you if you have been using R and want to improve your skills.</p>
</section>
<section id="advanced-r-3-days" class="level2">
<h2 class="anchored" data-anchor-id="advanced-r-3-days">ADVANCED R (3 days)</h2>
<p>Advanced data manipulation and visualisation; Advanced graphics; Statistical model building based on traditional and machine learning techniques; Programming and software development in the R language.</p>
<p>If you have used R extensively, then the Advanced R Workshop is for you.</p>
</section>
<section id="testimonials" class="level2">
<h2 class="anchored" data-anchor-id="testimonials">Testimonials</h2>
<p>June 2017: “I truly enjoyed the whole workshop. Great teachers, really nice real data examples and good notes and background. Everything was very well thought out and explained.”</p>
<p>June 2017: “I was really impressed with everything covered and how it was presented. I am feeling a lot better about using stats now than I was previously. I think it should be a compulsory course for all PhDs.”</p>
<p>Contact: carm@maths.uq.edu.au for more information or visit <a href="https://smp.uq.edu.au/event/session/5650">Centre for Applications in Resource Management site at UQ to register</a>.</p>
<hr>
</section>
<section id="post-2018-10-01-how-i-became-a-scicomm" class="level2">
<h2 class="anchored" data-anchor-id="post-2018-10-01-how-i-became-a-scicomm">POST: 2018-10-01-how-I-became-a-scicomm</h2>
<p>Path: posts/2018-10-01-how-I-became-a-scicomm/index.md</p>
<p>Would you consider yourself to be a science communicator, that is not just writing papers but doing other activities like doing interviews on radio?</p>
<div style="float:left;">
<img src="CB-scicomm-pres.jpg">
<p>
<em>Photo: Tom Rayner</em>
</p>
</div>
<p>This story is about how I became a science communicator, without ever intending too.</p>
<p>This blog is based on a talk I gave for the launch of the Australian Rivers Institute’s <a href="https://catchmenttocoast.org/2018/09/29/launch-of-our-magazine/">new science magazine</a>.</p>
<p>I used to think scicomm was doing interviews for print, radio and TV to try and reach general public. I definitely didn’t want to do interviews growing up. I wanted to be a marine biologist and help ocean ecosystems. Looking back though, it turns out I was always a keen science communicator.</p>
<p>In high school I took a creative writing course, as a kind of break from all the science and maths I was doing. My peers in the course were writing beautiful poems about love, drinking and drugs (we were 16!). I was the nerdy kid imagining I was a journalist for Scientific American, writing non-fiction magazine articles about cool science.</p>
<p>I never got very good marks in writing, but my creative writing teacher (Karen Clark) said something that has stuck in my head all these years. “keep practicising writing Chris, you will get good at it” (or something like that, it was a few years ago).</p>
<p>When I went on to do my PhD at UQ, writing become about papers and very technical.</p>
<p>During my PhD I was invited by Ben Halpern to attend training on science communications at the University of California, Santa Barbara.<br>
It was there I learned about Nancy Baron’s work “<a href="https://islandpress.org/books/escape-ivory-tower">Escape from the Ivory Tower</a>”. I became convinced that it was crucial for us to escape the ivory tower if science was to inform better policies and decisions about the environment. I thought I should try to do more scicomm.</p>
<p>The course was a lot about media interviews. I did a mock interview with an actual journalist from Scientific American, and failed badly. I felt that if this was what scicomm was about, it definitely wasn’t for me. At the course they also taught us about Twitter and I became interested in how we could connect with other people through social media.</p>
<p>I started tweeting in my first postdoc. But more importantly, I started seeing a lot of blogs on twitter. Now as a young postdoc at UQ I felt my emerging identity as an independent thinker and scientist was lost in UQ’s academic machine.</p>
<p>I realised that starting my own blog was a way I could present the identity I wanted to present to the world with full control. And share my own thoughts. So I started blogging.</p>
<p>At the same time I was still trying to escape from the ivory tower and the opportunity arose to do an interview for some North Queensland papers on my new study. When I arrived at the office next data the Uni’s media person had posted the article on the message board. Turns out the newspaper had also asked some local fisherman what they thought of my study. They had printed a quote in large font:</p>
<blockquote class="blockquote">
<p>“These guys have no brains”</p>
</blockquote>
<p>Yep, interviews and scicomm weren’t for me.</p>
<p>But I kept blogging.</p>
<p>And my blogs were being read. I would meet people overseas at workshops and they would say ‘hey I read your blog’. That was exciting. But I was really only reaching other scientists.</p>
<p>By the time I came to ARI I was becoming addicted to blogging. So much so that now I write about a PhD thesis worth of words in blogs every 18 months.</p>
<p>I hope one day I bump into my creative writing teacher on the street so I can tell her “hey, I practiced and I became a Writer!”</p>
<p>Things changed when I came to the Australian Rivers Institute and I started to identify as a science communicator. I think it is indicative of the wonderful supportive culture we have at ARI. The institute is great at supporting the career development of its ECRs.</p>
<p>At ARI I set up the institute’s blog and twitter feed (where I also do 10s of blogs per year and edit many more). I would help my colleagues write blogs about their science papers in a more accessible form. And I found I really enjoyed it.</p>
<p>I also learned there never was an ivory tower at ARI. Everyone was doing such great applied work, such as that the work Stuart Bunn and Michele Burford do with the National Environmental Science Program. Under this funding they are working directly with stakeholders to set science priorities and do the research that was needed.</p>
<p>That really changed my perspective on scicomm, it wasn’t just about interviews with journalists, it could be more targeted, directly speaking to the people that needed the research the most.</p>
<p>Then <a href="https://twitter.com/drlizob?lang=en">Liz O’Brien</a> from Griffith’s Research Office encouraged me to apply for a Tall Young Poppy Award in science media and communication and I won one. The recognition really helped me to start to identify as a communicator.</p>
<p>So then we went further and set up the <a href="https://catchmenttocoast.org/2018/08/31/scicomm-cadets/">ARI Scicomm cadets</a> program. So we are currently training four of our ECRs in science communications skills, everything from tweeting to engaging with stakeholders. And they are running some amazing activities like Man’s international Cyanobacteria Twitter conference that is coming up next month.</p>
<p>Then Prof Rod Connolly invited me to join an application for funding that has become the <a href="https://globalwetlandsproject.org/">Global Wetlands Project</a>. We hired a full-time science communicator. He’s here today – Tom Rayner – and is doing some amazing things that more strategic than I ever dreamed scicomm could be. We have integrated scicomm into our research from day 1, and have a strategy for everything from training ECRs to how to facilitate a two-way dialogue between researchers and stakeholders.</p>
<p>Tom and I are currently working on how we will monitor the project’s impact with stakeholders, so we can map the project’s pathways to impact over its 4 year duration.</p>
<p>With all of this interest in scicomm, I am very pleased to be at ARI as a researcher and science communicator for the launch of ARI’s magazine.</p>
<p>The magazine for me represents much of what ARI is about. It is showing to the world that not all scientists are stuck in the ivory tower.</p>
<p>It gives our early career researchers a voice so they can start to create their own research identity.</p>
<p>It is about reaching out to stakeholders and starting a conversation that will hopefully lead to better more useful science and more effective decision about our environment. People are less likely to raise comments like ‘they have no brains’ if they’ve had the chance to contribute to the science from day one.</p>
<p>So now you’ve heard my story, I’ll ask you again, are you a science communicator?</p>
<hr>
</section>
<section id="post-2025-08-21-points-framing-regional-study-international-literature" class="level2">
<h2 class="anchored" data-anchor-id="post-2025-08-21-points-framing-regional-study-international-literature">POST: 2025-08-21-points-framing-regional-study-international-literature</h2>
<p>Path: posts/2025-08-21-points-framing-regional-study-international-literature/index.md</p>
<p>At lab meeting today we discussed how to take your regional study and frame it for the global literature. This framing is essential for engaging international audiences and navigating editors and reviewers when publishing in international journals.</p>
<p>Thanks to the Seascapemodels and Conservation Action Team labs at Utas and Griffith Uni for their contributions.</p>
</section>
<section id="foundational-principles" class="level2">
<h2 class="anchored" data-anchor-id="foundational-principles">Foundational Principles</h2>
<p><strong>1. Consider your audience</strong></p>
<p>If you’re targeting an international journal, your readers will be international scientists. They will be less interested in hearing about the specific organisms in your part of the ocean and more interested in understanding what your results mean for their own research contexts. Frame your findings in terms of broader ecological patterns, processes, or principles that transcend geographic boundaries.</p>
<p><strong>2. Establish global context through strategic citations</strong></p>
<p>Cite global studies and literature from multiple regions, not just your local area. Global studies are often well-cited because they provide the comparative framework that regional studies need. When citing studies from other regions, be strategic about which ones you include:</p>
<ul>
<li><strong>Choose contrasting systems</strong>: Select studies from regions with different environmental conditions (temperate vs.&nbsp;tropical, shallow vs.&nbsp;deep, pristine vs.&nbsp;degraded) to highlight what makes your system unique or generalizable.</li>
<li><strong>Include similar systems for comparison</strong>: Find studies from ecologically similar regions to show whether your findings represent broader patterns or regional anomalies.</li>
<li><strong>Reference methodological precedents</strong>: Cite studies that used similar approaches in other regions, even if the ecological focus differs, to establish the credibility of your methods.</li>
<li><strong>Draw from different disciplines</strong>: Include studies from related fields (e.g., terrestrial ecology, freshwater systems) when they provide relevant theoretical context or methodological insights.</li>
</ul>
<p>Position your region within this broader context by explicitly comparing and contrasting your findings with patterns observed elsewhere. For example: “While coral bleaching in the Caribbean typically occurs at 29°C, our Pacific sites showed bleaching at 31°C, suggesting regional adaptation to higher baseline temperatures.” This demonstrates that you understand the global state of knowledge and can articulate where your work fits.</p>
</section>
<section id="specific-framing-strategies" class="level2">
<h2 class="anchored" data-anchor-id="specific-framing-strategies">Specific Framing Strategies</h2>
<p><strong>3. Connect to established theories and frameworks</strong></p>
<p>Relate your case-study to general ecological theories or established analytical frameworks. For example, your work could be an application of the DPSIR (Drivers-Pressures-State-Impact-Response) framework to your region, or a test of the recruitment limitation hypothesis in a new system. This approach transforms your regional study from a descriptive account into a contribution to broader scientific understanding.</p>
<p><strong>4. Demonstrate novelty without claiming “firsts”</strong></p>
<p>State your contributions by explaining why your approach or findings matter, rather than simply claiming precedence. Avoid phrases like “this is the first time.” Instead, draw parallels to successful applications in other fields or regions. For example, rather than “This is the first time we’ve used machine learning for fisheries,” try “Machine learning has proven highly effective for predictions in agriculture and could provide similar benefits for fisheries management.”</p>
<p><strong>5. Highlight unique perspectives and unexpected findings</strong></p>
<p>Show how your case-study reveals new patterns or challenges existing assumptions compared to other regional studies. Focus on findings that offer fresh insights into well-studied processes. For example: “While marine heatwaves are known to cause widespread mortality, our study reveals that toxic plankton blooms can flourish during these events, creating compound ecological impacts.”</p>
<p><strong>6. Present methodological innovations</strong></p>
<p>Frame your work as developing or refining methodological approaches, with your regional study serving as a proof-of-concept. This strategy is particularly powerful when you’ve adapted techniques from other disciplines or combined existing methods in novel ways. Emphasize how the method could be applied in other regions or systems, making your local study a stepping stone to broader applications.</p>
</section>
<section id="practical-applications-and-impact" class="level2">
<h2 class="anchored" data-anchor-id="practical-applications-and-impact">Practical Applications and Impact</h2>
<p><strong>7. Demonstrate real-world applications</strong></p>
<p>When conducting applied research, explicitly show how your science has been used for conservation or management decisions. One excellent example is Rick Hamilton’s <a href="https://www.sciencedirect.com/science/article/pii/S0006320721002925">turtle tracking paper</a>. While countless studies track turtles, Hamilton got his work published in an international conservation journal by demonstrating how the tracking data directly informed conservation actions. He also capitalized on a review highlighting that most tracking studies fail to influence conservation practice, establishing his work’s unique value.</p>
<p><strong>8. Connect to global goals and initiatives</strong></p>
<p>Link your research to internationally recognized objectives and frameworks. This connection is increasingly common and effective. For example: “SDG 14.4 aims to make fisheries sustainable by 2020. Achieving this goal requires better models of climate impacts on fish populations—precisely what our study provides.” Other relevant frameworks include the Convention on Biological Diversity targets, national biodiversity strategies, and organizational goals like those of the Global Mangrove Alliance. These connections help editors and reviewers understand your work’s broader significance.</p>
<hr>
</section>
<section id="post-2025-11-15-should-i-do-a-pre-print" class="level2">
<h2 class="anchored" data-anchor-id="post-2025-11-15-should-i-do-a-pre-print">POST: 2025-11-15-should-i-do-a-pre-print</h2>
<p>Path: posts/2025-11-15-should-i-do-a-pre-print/index.md</p>
<p>In our recent lab meeting we <a href="https://www.seascapemodels.org/posts/2018-08-20-biorxiv-pre-print-posting-guide/index.html">revisited the topic of pre-prints and pre-print servers</a> to answer the question - should I post a pre-print of my manuscript?</p>
<p>Thanks to Jordan Holdorf for helping me write this post and Matt Holden for contributions via linkedin.</p>
<p>In a recent lab meeting, we revisited the question: Should I post a preprint of my manuscript? A few years ago, <a href="https://www.seascapemodels.org/posts/2018-08-20-biorxiv-pre-print-posting-guide/index.html">I wrote about this topic after posting my fourth preprint to bioRxiv</a>. Since then, the landscape has shifted, and our discussion—thanks to Jordan Holdorf for the notes—highlighted new considerations worth sharing.</p>
<p><img src="../posts/2025-11-15-should-i-do-a-pre-print/pre-print-illustration.jpg" class="img-fluid"></p>
<p>*Generated by Google Gemini.</p>
</section>
<section id="what-are-preprints" class="level2">
<h2 class="anchored" data-anchor-id="what-are-preprints">What Are Preprints?</h2>
<p>Preprints are manuscripts shared publicly before formal peer review. They’re free to post, free to read, and usually come with a DOI, making them citable. Popular servers include arXiv, bioRxiv, EcoEvoRxiv, medRxiv, and SSRN.</p>
<p>The concept isn’t new, arXiv launched in physics back in 1991, but preprints surged during COVID-19 as scientists raced to share findings quickly. Conservation science and ecology have increasingly embraced preprints as well.</p>
</section>
<section id="why-bother-pros-and-cons" class="level2">
<h2 class="anchored" data-anchor-id="why-bother-pros-and-cons">Why Bother? Pros and Cons</h2>
<section id="pros" class="level3">
<h3 class="anchored" data-anchor-id="pros">Pros</h3>
<ul>
<li>Visibility and speed: Your work is accessible immediately, not months later.</li>
<li>Feedback: Pre-review comments can strengthen your paper.</li>
<li>Citations: Preprints can be cited, even if the journal version is paywalled.</li>
<li>Priority: Posting establishes your claim to an idea.</li>
<li>Flexibility: You can build on work that’s still under review.</li>
</ul>
</section>
<section id="cons" class="level3">
<h3 class="anchored" data-anchor-id="cons">Cons</h3>
<ul>
<li>Quality concerns: Preprints aren’t peer-reviewed, so errors can spread.</li>
<li>Misinformation risk: Especially if high-profile topics get picked up by the press.</li>
<li>Version confusion: If titles change, citations may split across versions.</li>
<li>Journal policies: Most journals now allow preprints, but check first.</li>
<li>Double-blind issues: Reviewers can find your preprint and identify authors.</li>
<li>Time cost: Uploading and revising adds extra steps.</li>
<li>Google Scholar may not list your published article for up to 6 months after publication (rather than the normal few days delay after publishing). This is a known issue with pre-prints on SSRN and bioRxiv, apparently fixed for arxiv pre-prints.</li>
</ul>
<p>Overall, the benefits usually outweigh the drawbacks—if you manage the process carefully.</p>
</section>
</section>
<section id="key-considerations" class="level2">
<h2 class="anchored" data-anchor-id="key-considerations">Key considerations</h2>
<p>Some lab members expressed concern that their work could get stolen from a pre-print and published by an other author. I would think this is rare, however, with AI making it increasingly easy to paraphrase other people’s work, the risk is probably higher than it used to be.</p>
<p>We decided that if you are concerned about plagiarism, it is best not to link your open code repository in the preprint. That could make it too easy for a bad actor to create a new version of your work.</p>
<p>Media is another factor. Journalists generally prefer to cover peer-reviewed work, though during COVID, preprints made headlines. For most fields, you can expect little media attention until formal publication. This is good, as peer review is crucial for credibility.</p>
<p>Finally, think strategically. Preprints make sense for urgent topics, methods papers, or when you want community feedback. They’re less practical if you’re under time pressure or working on a niche topic.</p>
</section>
<section id="how-to-post-a-preprint" class="level2">
<h2 class="anchored" data-anchor-id="how-to-post-a-preprint">How to Post a Preprint</h2>
<p>Here’s a streamlined guide based on experience and Jordan’s notes:</p>
<ul>
<li>Finish the manuscript and get coauthor approval. Check your target journal’s preprint policy.</li>
<li>Format carefully. Upload a polished PDF with clear figures, tables, and your contact info.</li>
<li>Sign up for a server and ORCID. ORCID helps link your work across platforms.</li>
<li>Choose a license. Think about reuse—Creative Commons options vary.</li>
<li>Upload and wait. Most servers take ~24 hours to post.</li>
<li>Share strategically. Share on social media (to other scientists, not for general public), email colleagues, or post on Google Scholar if you want feedback.</li>
<li>Revise before acceptance. Once your paper is accepted, most servers block updates. Link the final version. Matching titles help merge citations; otherwise, see the server’s instructions for how to fix the connection.</li>
</ul>
</section>
<section id="my-experience" class="level2">
<h2 class="anchored" data-anchor-id="my-experience">My Experience</h2>
<p>I’ve had mixed results. One preprint was redundant because the journal review was lightning-fast. Another has been cited multiple times while stuck in review purgatory—proof that preprints can keep your work alive. The biggest headache? Title changes. If your published title differs, make sure the preprint links correctly.</p>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final Thoughts</h2>
<p>Preprints aren’t a magic bullet, but they’re a powerful tool when used thoughtfully. They accelerate science, increase visibility, and invite collaboration—but they also demand care around version control, anonymity, and journal policies.</p>
<p>On the balance of it I use them selectively. For work that is time-sensitive, methodologically important, or where I want feedback, then I do a pre-print. If I’m busy or there is little to gain, then I skip it.</p>
<hr>
</section>
<section id="post-2025-02-12-llms-for-literature-reviews" class="level2">
<h2 class="anchored" data-anchor-id="post-2025-02-12-llms-for-literature-reviews">POST: 2025-02-12-LLMs-for-literature-reviews</h2>
<p>Path: posts/2025-02-12-LLMs-for-literature-reviews/index.md</p>
<p>In the near future, we will all be doing systematic lit reviews by getting LLMs to gather data from papers. Below is an example of how to extract text data from a study. Once you can interact with LLM from R, you can then batch process many documents to turn text into structured data.</p>
<p>TLDR; Developing a data extraction workflow is hard work. The development of prompts, data extraction and data cleaning is time consuming and requires thought. So it will still take work to do a systematic review. I’d also recommend you manually check results so that you still learn something yourself and to correct errors.</p>
<p>I’ll also mention that papers are coming out now testing this idea, e.g.&nbsp;this one shows the <a href="https://www.nature.com/articles/s44185-024-00043-9">AI’s results can be accurate, but only for some types of requests</a>. The supplemental code for that paper also has helpful guidance.</p>
<p>We’ll need a few R skills to extract data from papers for lit reviews:</p>
<ol type="1">
<li>How to interact with LLMs through APIs from R</li>
<li>How to handle pdf docments and extract text from them</li>
<li>How to clean up semi-structured text data and turn it into structured data.</li>
<li>How to batch process.</li>
</ol>
<p>I’ll mainly focus on step 1 here. Step 2 is possible, by can be finniky and depend on how the pdf is formated. Step 3 is pretty straightforward with a package like <code>stringr</code>. Step 4 is just looping with whatever framework you prefer for that (e.g.&nbsp;for loops or purrr).</p>
<p>This blog deals with only one type of application of LLMs to lit reviews, that is maybe the most straightforward and cheapest. There are other ways to use them to write syntheses or discover research trends, such as finetuning models on a large corpus of papers.</p>
<section id="setting-up-your-api-access" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-your-api-access">Setting up your API access</h3>
<p>API = application programming interface. This is a way to interact with a service (the LLM provider) via R.</p>
<p>First you will need to go to your LLM provider of choice (here I’m using anthropic) and get an API key. This will require you to register and then buy some credits. You will per charged per token (fragment of a word) that you use.</p>
<p>I’ve started out with 25USD which seems to be sufficient for testing. I’ve got no idea yet how much it will cost to do a full systematic lit review with 100s of papers.</p>
<p>Now get your API key. Keep this secret its like a password. Also you can only view it once, so you’ll need to save it, e.g.&nbsp;in a password manager.</p>
</section>
<section id="using-the-api-key-in-r" class="level3">
<h3 class="anchored" data-anchor-id="using-the-api-key-in-r">Using the API key in R</h3>
<p>I’m using the <code>dotenv</code> package to help manage API. First, make sure <code>.env</code> is in your <code>.gitignore</code> file. This way you can’t inadvertently share your key with the world.</p>
<p>Now create a file in a text editor (e.g.&nbsp;Rstudio or VSCode) called <code>.env</code>. Put this is your project folder.</p>
<p>The file will look like this:</p>
<pre><code>ANTHROPIC_KEY="your_api_key_here"</code></pre>
<p>Be sure to hit enter after the last line.</p>
<p>Now you can use the <code>dotenv</code> package to load the key into your R session. <a href="https://www.r-bloggers.com/2018/08/structuring-r-projects/">This blog has good advice on managing secrets</a></p>
<pre><code>dotenv::load_dot_env('.env')</code></pre>
<p>Check it worked to load the key:</p>
<pre><code>Sys.getenv("ANTHROPIC_KEY")</code></pre>
<p>This should print your key.</p>
</section>
</section>
<section id="interacting-with-the-api-from-r" class="level2">
<h2 class="anchored" data-anchor-id="interacting-with-the-api-from-r">Interacting with the API from R</h2>
<p>Now you are ready to use the API. There are quite a few packages that can help you do this. I’m going to use the new <code>tidychatmodels</code> package, because I like its syntax (its like tidymodels).</p>
<p><a href="https://albert-rapp.de/posts/20_tidychatmodels/20_tidychatmodels">Install instructions are here</a> (its not on cran as of writing) and <a href="https://albert-rapp.de/posts/21_pdf_extraction/21_pdf_extraction">here is a nice example of how to use LLMs with pdfs</a>, which helped me greatly with writing this blog.</p>
<pre><code>library(tidyverse)
library(tidychatmodels)</code></pre>
<p>Now start building the instructions to send to the API. tidychatmodels does this step by step with pipes. So we are going to build up a sequence of commands. In the final step we’ll send it to the API.</p>
<pre><code>newchat &lt;- create_chat("anthropic", 
    api_key = Sys.getenv("ANTHROPIC_KEY"),
    api_version = '2023-06-01')</code></pre>
<p>Here I’m using ‘anthropic’, but there are others e.g.&nbsp;openai and mistral.</p>
<p>Now add a model. I got the model name on the <a href="https://docs.anthropic.com/en/docs/about-claude/models">APIs webpage</a></p>
<p>Model choice is dictated by speed, cost and the type of task you want to do. Do some research to optimise this.</p>
<p>I’m also setting the temperature to control the level of creativitiy in the output, lower values = less creative. max_tokens controls the length of the output.</p>
<pre><code>newchat &lt;- add_model(newchat, "claude-3-5-haiku-20241022") |&gt;
      add_params('temperature' = 0.2, max_tokens = 800) </code></pre>
</section>
<section id="prompting-through-the-api" class="level2">
<h2 class="anchored" data-anchor-id="prompting-through-the-api">Prompting through the API</h2>
<p>Let’s do a test run. I’ll create some text</p>
<pre><code>newchat &lt;- newchat |&gt;
  add_message(
    role = 'user',
    message = 'You are a funky dude who loves writing online R lessons.
    Write a paragraph about loading dataframes in R. '
  ) </code></pre>
<p>Now we’re ready to hit the dance floor. This is the bit where we actually ask the LLM to do something. It is also the bit that costs money….</p>
<pre><code>newchat &lt;- newchat |&gt;
    perform_chat()
responses &lt;- newchat |&gt; extract_chat()</code></pre>
<p>So the first time I ran this I got a ‘400’ error. Turns out the ‘max_tokens’ parameter was essential to set. This parameter controls the length of output. Longer outputs cost more (you’re charged per token).</p>
<p>Error in <code>httr2::req_perform()</code>: ! HTTP 400 Bad Request. Backtrace: 1. tidychatmodels::perform_chat(newchat) 5. httr2::req_perform(prepared_engine)</p>
</section>
<section id="roles" class="level2">
<h2 class="anchored" data-anchor-id="roles">Roles</h2>
<p>Most LLMs have different roles, often a ‘user’ and a ‘system’ role. These give you more precise control over the LLM’s output. There is great advice from vendors on how to use these roles, e.g.&nbsp; with (anthropic)[<a href="https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/system-prompts#legal-contract-analysis-with-role-prompting" class="uri">https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/system-prompts#legal-contract-analysis-with-role-prompting</a>]</p>
<p>Setting a system role controls how the LLM behaves. People use these to make the AI act like a certain character, such as a research assistant. Let’s see it in action.</p>
<p>Prompting is like programming, but less precise (annoyingly for me, who likes programming and things to be exact!). Good prompts will tend to get you better results. But of course, as with all deep learning, outcomes have an element of randomness, so can be inconsistent.</p>
<pre><code>base_settings &lt;- create_chat("anthropic", 
    api_key = Sys.getenv("ANTHROPIC_KEY"),
    api_version = '2023-06-01') |&gt; 
    add_model("claude-3-5-haiku-20241022") |&gt;
    add_params('temperature' = 0.8, max_tokens = 100) 

newchat &lt;- base_settings |&gt;
  add_message(
    role = 'system',
    message = 'You are a funky dude who loves writing online R lessons.'
  ) |&gt; 
  add_message(
    #defaults to 'user' role
    message = 'Write a paragraph about loading dataframes in R. ') |&gt;
    perform_chat() 

extract_chat(newchat)</code></pre>
<p>Ok, so the system role didn’t work very well in this case. To get the ‘funky dude’ output you need to put that into the user role.</p>
<p>Now let’s look at doing this for a real paper.</p>
</section>
<section id="extracting-text-from-a-pdf" class="level2">
<h2 class="anchored" data-anchor-id="extracting-text-from-a-pdf">Extracting text from a pdf</h2>
<p>I’m going to use my <a href="https://doi.org/10.1111/conl.13056">recent paper on turtle mortality as an example, becuase I know it well</a> and the file size isn’t too large.</p>
<p>Now we can use the pdftools package to read in the text from file. You could also try reading this directly from the web as HTML, which might allow you to identify particular sections, or data in tables, more effectively (by using html tags).</p>
<p>Just note that making repeat requests for html pages might get you temporarily blocked from the publisher’s server.</p>
<pre><code>library(pdftools)
text &lt;- pdf_text("data/Brown_etal2024 national scale turtle mortality.pdf")</code></pre>
<p>Now doing the above failed to work, I got that darn 400 error again when I sent it to the API. The issue seemed to be in the formatting of the text. So I can get on with the next step, I’ve just cut and paste the text into a text file. Clearly the cleaning up of pdfs/html for use will be a big part of this process. (like all modelling, data cleaning usually takes up most of the time).</p>
<pre><code>methods_text &lt;- readLines("data/example-text.txt") |&gt;
    paste(collapse = " ")</code></pre>
</section>
<section id="sending-text-to-the-llm" class="level2">
<h2 class="anchored" data-anchor-id="sending-text-to-the-llm">Sending text to the LLM</h2>
<p>Now we have our text we can send it to the LLM.</p>
<pre><code>newchat &lt;- base_settings |&gt;
    add_params('temperature' = 0.2, max_tokens = 600) |&gt; 
    add_message(
    role = 'system',
    message = "You are a research assistant who has been asked to summarise the methods section of a paper on turtle mortality.
    You will extract key statistics on:
    Sample size: &lt;&lt; Insert sample size here&gt;&gt;
    Year of the study: &lt;&lt; Insert year here&gt;&gt;
    DONT EXTRACT ANY MORE INFORMATION BEYOND THIS POINT.
    "
  ) |&gt; 
     add_message(
         message = methods_text
    ) |&gt;
  perform_chat()

extract_chat(newchat)</code></pre>
<p>The prompt is key here. In the system role we’ve told it to extract the data in a structured way. I also included ‘DONT EXTRACT ANY MORE INFORMATION BEYOND THIS POINT.’ to prevent it from continuing to talk. Using caps emphasises the point to the AI.</p>
<p>Here’s the output:</p>
<blockquote class="blockquote">
<p>Based on the methods section, here are the key statistics: Sample size: 357 sets (electronic monitoring) for large-scale longline fishery (LLF) Year of the study: 2018</p>
</blockquote>
<p>Here’s the output without the final part in caps:</p>
<blockquote class="blockquote">
<p>Assistant: Based on the methods section, here are the key statistics: Sample size: - For Small-Scale Fisheries (SSF): Monitored catches from 10 communities across 8 of 9 provinces - For Large-Longline Fisheries (LLF): 357 sets reviewed, spanning from 2018-01-24 to 2019-08-17 - Total catch events for LLF: 25,403 catch events - Electronic monitoring deployed on 7 vessels Year of the study: 2018 (primary year of data collection) Additional notable details: - Used non-parametric bootstrapping for scaling up and estimating confidence intervals - Monitoring methods involved trained community members and electronic monitoring systems - Video review of LLF data took 0.5 to 2 days per set - Used three different methods to scale up turtle catch for LLF to account for variability</p>
</blockquote>
<p>This is all very accurate, but includes too much ‘additional details’. However, it does get more of the methods details with regards to the various sample sizes for different parts of the study.</p>
<p>Let’s get the output text:</p>
<pre><code>chatout &lt;- extract_chat(newchat)
output &lt;- chatout[chatout$role == 'assistant', 'message']</code></pre>
<p>For repeatability just for the blog I’m hard coding that</p>
<pre><code>output &lt;- data.frame(message = "Based on the methods section, here are the key statistics:\n\nSample size: 357 sets (electronic monitoring) for large-scale longline fishery (LLF)\nYear of the study: 2018")</code></pre>
</section>
<section id="turn-text-into-structured-data" class="level2">
<h2 class="anchored" data-anchor-id="turn-text-into-structured-data">Turn text into structured data</h2>
<p>Our data is semi structured by the way we did the prompt. Now we want to put the sample size and year into data fields.</p>
<p>I’m using <code>separate_wider_delim</code> to first seperate out the first paragraph that had two breaks ’’, then again to split the sample size and year into columns (they were seperated by ’’).</p>
<p>Finally, str_remove_all gets rid of the ‘Sample size:’ and ‘Year of the study:’ text.</p>
<pre><code>library(stringr)

cleaned_output &lt;- output |&gt; 
  separate_wider_delim(
    cols = message, 
    delim = '\n\n',
    names = c('response', 'stats')
  ) |&gt; 
separate_wider_delim(
    cols = stats, 
    delim = '\n',
    names = c('sample_size', 'year')
) |&gt; 
  mutate(
    across(
      sample_size:year,
      \(x) str_remove_all(
        x, 
        'Sample size: |Year of the study: '
      )
    ))</code></pre>
<p>So now we can easily get our variables (sort of)</p>
<pre><code>cleaned_output$sample_size
cleaned_output$year</code></pre>
</section>
<section id="reflections-on-challenges-and-next-steps-for-automating-data-extraction" class="level2">
<h2 class="anchored" data-anchor-id="reflections-on-challenges-and-next-steps-for-automating-data-extraction">Reflections on challenges and next steps for automating data extraction</h2>
<section id="cost-uncertainty" class="level3">
<h3 class="anchored" data-anchor-id="cost-uncertainty">Cost uncertainty</h3>
<p>This should be cheap. It cost &lt;1c to make this post with all the testing. So in theory you could do 100s of methods sections for &lt;100USD. However, if you are testing back and forwards a lot or using full papers the cost could add up. It will be hard to estimate this until people get more experience.</p>
</section>
<section id="obtaining-the-papers-and-dealing-with-unstructued-text-in-pdfs-or-html" class="level3">
<h3 class="anchored" data-anchor-id="obtaining-the-papers-and-dealing-with-unstructued-text-in-pdfs-or-html">Obtaining the papers and dealing with unstructued text in PDFs or HTML</h3>
<p>A big challenge will be getting the text into a format that the LLM can use. Then there are issues like obtaining the text. Downloading pdfs is time consuming and data intensive. Trying to read text data from webpages can also be hard, due to paywalls and rate limits (you might get blocked for making reqeat requests).</p>
<p>For instance, <a href="https://onlinelibrary.wiley.com/doi/full/10.1111/brv.12344?casa_token=LVnFzoFBBU8AAAAA%3AcsyopYDWDBRZN7y2JL7eHYxzqayxu2GvKB-7gdEYkdeZSi5p5o1oXTwj49FqwBJz-IpPS6wxJ_SX0h2f">in a past study we did where we did simple ‘bag of words analysis’</a> we either downloaded the pdfs manually, or set timers to delay web hits and avoid getting blocked.</p>
<p>HTML format would be ideal, because the tags mean the sections of the paper, and the figures already semi-structured.</p>
</section>
<section id="prompting" class="level3">
<h3 class="anchored" data-anchor-id="prompting">Prompting</h3>
<p>Need to experiment with this to get it right. It might also be good to repeat prompt the same text to triangulate accurate results.</p>
</section>
<section id="llm-text-output-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="llm-text-output-cleaning">LLM text output cleaning</h3>
<p>In my simple example this was easy. However, with a large number of prompts and papers the LLM responses might have more variability that needs to be dealt with, e.g.&nbsp;will it always use one line break between my data questions? You can help control this issue by asking it to structure output in xml or JSON format, which is easier to then parse into data sheets.</p>
</section>
<section id="the-data-still-isnt-data-and-requires-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="the-data-still-isnt-data-and-requires-interpretation">The data still isn’t data and requires interpretation</h3>
<p>You can see from my simple examples above that the output can’t be plotted direclty. In fact, it requires more interpretation. The sample size was given as ‘357 sets (electronic monitoring) for large-scale longline fishery (LLF)’. So is it 357? Are there other sample sizes that might be relevant?</p>
</section>
<section id="validation" class="level3">
<h3 class="anchored" data-anchor-id="validation">Validation</h3>
<p>You’ll definitely want to manually check the output and report accuracy statistics in your study. So maybe your review has 1000 papers, you’ll want to manually check 100 of them to see how accurate the LLM was.</p>
</section>
<section id="youll-still-need-to-read-a-lot-of-papers-to-write-a-good-lit-review" class="level3">
<h3 class="anchored" data-anchor-id="youll-still-need-to-read-a-lot-of-papers-to-write-a-good-lit-review">You’ll still need to read a lot of papers to write a good lit review</h3>
<p>A lit review is more than the systematic data. I still believe you need to read a lot of papers in order to understand the literature and make a useful synthesis. If you just use AI you’re vulnerable to the <a href="https://www.nature.com/articles/s41586-024-07146-0">‘illusion of understanding’</a>.</p>
</section>
<section id="conclusion-1" class="level3">
<h3 class="anchored" data-anchor-id="conclusion-1">Conclusion</h3>
<p>This tool will be best for well defined tasks and consistently written papers. For instance, an ideal use case would be reviewing 500 ocean acidification papers that all used similar experimental designs and terminology. You’ll then be able to get consistent answers to prompts about sample size etc…</p>
<p>Another good use case would be to extract model types from species distribution model papers.</p>
<p>Harder tasks will be where the papers are from diverse disciplines, or use inconsistent terminology, or methods. My study was a good example of that, there were about 5 different sample sizes reported. So in this example we’d need first to think clearly about what sample size you wanted to extract before writing the prompt.</p>
<hr>
</section>
</section>
<section id="post-2018-10-16-understanding-the-glm-link" class="level2">
<h2 class="anchored" data-anchor-id="post-2018-10-16-understanding-the-glm-link">POST: 2018-10-16-understanding-the-glm-link</h2>
<p>Path: posts/2018-10-16-understanding-the-glm-link/index.md</p>
</section>
</section>
<section id="generalized-linear-models-understanding-the-link-function" class="level1">
<h1>Generalized Linear Models: understanding the link function</h1>
<p>Generalized Linear Models (‘GLMs’) are one of the most useful modern statistical tools, because they can be applied to many different types of data. Count, binary ‘yes/no’, and waiting time data are just some of the types of data that can be handled with GLMs.</p>
<p>We often call such data ‘non-normal’ because its distribution doesn’t follow a normal distribution (also known as the bell curve or Gaussian Distribution).</p>
<p>In this post I will look at how GLMs use a ‘link function’ to model non-normal data. I think there is a sort of beautiful elegance in the maths of how the link function works. Understanding this theory will also help you build better models for your data and interpret them in more nuanced ways.</p>
<p>We will step through the math behind the GLM and build it up from scratch.</p>
<p>GLMs extend ‘General Linear Models’ (confusing names I know), read <a href="http://www.seascapemodels.org/rstats/2018/01/19/intro-to-glms.html">this post first if you are not yet familiar with General Linear Models</a>.</p>
<p>Thanks is due to Brad Biggerstaff for emailing some errors in terminology in my original post (which I’ve updated and hopefully fixed 19/10/2018).</p>
<section id="choosing-the-right-distribution-for-your-data" class="level2">
<h2 class="anchored" data-anchor-id="choosing-the-right-distribution-for-your-data">Choosing the right distribution for your data</h2>
<p>I learned about the Normal distribution in primary school. The normal distribution is central to much of statistics (no pun intended), but there are many types of data that don’t meet the basic assumptions of the normal.</p>
<p>The normal distribution has ‘infinite support’, which means values modelled by the normal can take any negative or positive number. Often the normal is a pretty reasonable approximation of data that doesn’t meet these assumptions, but there are many cases when using a normal for data that isn’t will lead us to make errors in our inferences.</p>
<p>Statisticians have invented whole families of distributions to describe any type of data you can imagine, from the morbid (the Exponential distribution for deaths or decay), to wealth inequality (the Pareto distribution) and even days of the year (the Von Mises distribution).</p>
<p>More specifically, we should think of the distribution as a description of the process that generates the data.</p>
<p>Let’s start with something simple. Let’s assume you have been counting fish on coral reefs. So your data are count data.</p>
<p>If the counts are large they may well look pretty normal. But there are some important differences.</p>
<p>Counts are integers, whereas the normal distribution is for continuous data that can include any fraction.</p>
<p>Counts also can’t be less than zero, but the Normal distribution model’s stochastic processes that draw zeros and negative numbers.</p>
<p>Statisticians have invented many distributions for counts, one of the simplest is the Poisson distribution. It is a model of positive integers. It has one parameter <em>λ</em>, which is both its mean and variance.</p>
<p>Let’s see what that looks like with some simple R code to draw random numbers from two Poisson distributions:</p>
<pre><code>n &lt;- 1000
set.seed(42)
x1 &lt;- rpois(n, lambda = 1)
x10 &lt;- rpois(n, lambda = 10)
mean(x1)

## [1] 0.976

var(x1)

## [1] 0.9663904

mean(x10)

## [1] 10.083

var(x10)

## [1] 10.75086</code></pre>
<p>We just sampled random numbers from two Poisson distributions with means of 1 and 10. Notice that the means and variances of each are approximately equal (not exactly equal because of we drew a small random sample).</p>
<p>You can think of this sampling from the Poisson as a model of count data. Let’s see what that looks like:</p>
<pre><code>par(mfrow=c(1,2))
hist(x1, xlim = c(0, 25), seq(0, 25, by = 1))
hist(x10, xlim = c(0, 25), seq(0, 25, by = 1))</code></pre>
<p><img src="beauty-of-the-glm-link_files/figure-markdown_strict/unnamed-chunk-2-1.png" class="img-fluid"></p>
<p>So the data drawn from the poisson with <code>lambda = 1</code> are concentrated near zero and strongly skewed (not very Normal). The data with <code>lambda = 10</code> are approximately normally distribution and have a much larger variance than the former data.</p>
</section>
<section id="linear-models" class="level2">
<h2 class="anchored" data-anchor-id="linear-models">Linear models</h2>
<p>So far our Poisson model only has one parameter, a mean (and variance). But what if we wanted the mean to change?</p>
<p>For instance, we might have counted fish on different types of coral reefs and we want to test whether there are difference abundances on each type of reef.</p>
<p>Or we might have counted fish across a gradient of pollution and we want to know how their numbers change from low to high pollution.</p>
<p>I will call these hypothesized causes of changes in fish counts ‘covariates’. Others might call them explanatory variables, treatments (if experiments) or predictor variables.</p>
<p>We are using <strong>Generalized Linear Models</strong>, so we could include the covariates as variables in a simple linear equation, after all that is what we do with linear regression (and <a href="http://www.seascapemodels.org/rstats/2018/01/19/intro-to-glms.html">general linear models</a>):</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><embed src="http://latex.codecogs.com/svg.latex?y_%7Bi%7D%3D%5Calpha%2B%5Cbeta%2Ax_%7Bi%7D" class="img-fluid"></p>
<figcaption>img</figcaption>
</figure>
</div>
<p>Let’s generate some such data ourselves. We will assume pollution is measured on a zero to one (low to high) scale, that the mean number of fish with no pollution =4 and that on average there are no fish anymore when pollution levels = 0.5 (half their maximum).</p>
<p>The plot below illustrates our model for the mean expected number of fish across the pollution gradient. In this case we are building a model to simulate some data to practice with:</p>
<pre><code>n &lt;- 50
beta &lt;- -8 #effect of polluted reefs
alpha &lt;- 4 #intercept = mean at 'zero' pollution
x &lt;-  seq(0, 1, length.out = n) #pollution levels
ymean &lt;- alpha + beta*x
plot(x, ymean, type = 'l', xlab = "Pollution level", ylab = "Number of fish counted")
abline(h = 0, lty = 2, lwd = 2)  </code></pre>
<p><img src="beauty-of-the-glm-link_files/figure-markdown_strict/unnamed-chunk-3-1.png" class="img-fluid"></p>
<p>There is something odd about this model: we are predicting negative fish (on average) for pollution levels over 0.5.</p>
<p>It gets even worse if we model sampling with a normal distribution:</p>
<pre><code>set.seed(55)
yobs_normal &lt;- ymean + rnorm(n)
plot(x, ymean, type = 'l', xlab = "Pollution level", ylab = "Number of fish counted")
points(x, yobs_normal)
abline(h = 0, lty = 2, lwd = 2)</code></pre>
<p><img src="beauty-of-the-glm-link_files/figure-markdown_strict/unnamed-chunk-4-1.png" class="img-fluid"></p>
<p>Clearly if we went in the real world to sample data, we wouldn’t ever get any negative counts.</p>
<p>So we are going to have to redesign our model, which is the basis of our statistical tests, so that negative values don’t happen.</p>
<p>But we still want to use a linear model, because they are convenient to work with mathematically and convenient when it comes to estimating the unknown effects.</p>
</section>
<section id="simulating-poisson-data-from-a-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="simulating-poisson-data-from-a-linear-model">Simulating Poisson data from a linear model</h2>
<p>So now we come to link functions. Link functions elegantly solve the problem of using linear models with with non-normal data. There are many types of link functions, but we will look at one that is popular for use with count data.</p>
<p>If you wanted to stop a linear function from taking negative values what is one simple transformation you could make?</p>
<p>Well, you could take the function’s exponent. We will redo the above linear equation as log-linear. I will change the parameter names to reflect that they are now logs:</p>
<pre><code>gamma &lt;- -3.2 #effect of polluted reefs
alpha &lt;- 4 #intercept = mean at 'zero' pollution
yexp &lt;- alpha*exp(gamma*x)
plot(x, yexp, type = 'l', xlab = "Pollution level", ylab = "Number of fish counted")
abline(h = 0, lty = 2, lwd = 2)</code></pre>
<p><img src="beauty-of-the-glm-link_files/figure-markdown_strict/unnamed-chunk-5-1.png" class="img-fluid"></p>
<p>Here we have the equation <code>y = alpha *exp(gamma*x)</code> which is the same as the linear equation for <code>log(y)</code>: <code>log(y) = log(alpha) +gamma*x</code>. Note I have retained <code>alpha=4</code> in both, because for both equations <code>alpha</code> is the expected value at pollution of zero.</p>
<p>I changed the slope parameter in the log-linear equation to <code>gamma</code> because it is not a direct analogue of our slope parameter <code>beta</code> above.</p>
<p>One of the nice things about the log-linear equation is that the slope parameter now represents multiples of change. For instance, <code>gamma = -3.2</code> means the abundance declines about 25 times decline (=<code>1/exp(-3.2)</code>) when going from a pollution level of <code>0</code> to <code>1</code>.</p>
<p>Abundance declines about a five times decline if we go from a pollution of <code>0</code> to <code>0.5</code> (= <code>1/exp(-3.2*0.5)</code>). Noting this will be important when we come to interpreting fitted models below.</p>
<p>We could now use this exponential curve as the mean (and variance!) of a Poisson:</p>
<pre><code>yobs_pois &lt;- rpois(n, yexp)
plot(x, yexp, type = 'l', xlab = "Pollution level",
     ylab = "Number of fish counted",
     ylim = c(0, 8))
points(x, yobs_pois)</code></pre>
<p><img src="beauty-of-the-glm-link_files/figure-markdown_strict/unnamed-chunk-6-1.png" class="img-fluid"></p>
<p>Notice that no data fall below zero now. Also, notice how the variance of the samples gets smaller as the mean gets smaller.</p>
</section>
<section id="the-beauty-of-the-link-combining-linear-models-with-bespoke-distributions" class="level2">
<h2 class="anchored" data-anchor-id="the-beauty-of-the-link-combining-linear-models-with-bespoke-distributions">The beauty of the link: combining linear models with bespoke distributions</h2>
<p>In the real world, you will have the sample points, but not the ‘true’ mean. In the example above we just made up the true mean ourselves. In the real world Nature provides the ‘truth’ about how pollution impacts fish abundance and the best we can do is take as many measurements as we can and hope to get near the truth.</p>
<p>To estimate the effect of the pollution covariate you can use R’s <code>glm()</code> function:</p>
<pre><code>m1 &lt;- glm(yobs_pois ~ x, family = poisson(link = "log"))
coef(m1)

## (Intercept)           x
##    1.409704   -3.345646</code></pre>
<p>The values we printed give the estimates for the intercept and slope coeffcients (alpha and gamma). You can check that these are similar to the true estimates we provided by comparing them to <code>log(alpha)</code> and <code>gamma</code>.</p>
<p>I have specified above the type of distribution to use (<code>family = poission()</code>) and which link to use. <code>"log"</code> is in fact the default choice, but I put it there so you know you can change it.</p>
<p>For instance, you can use <code>"identity"</code> link for data that is far from zero. If you use the identity link, which is basically no link function, your model will be linear, not log-linear, so your slope estimate will once again be additive.</p>
<p>Technically we would say we fitted a <em>Poisson Generalized Linear Model with a log link function</em>. So the model’s predictions for the data will be Poisson distributed about its estimate for the mean. Note that the data can contain zeros, but the mean of the Poisson is always &gt;0.</p>
<p>So what do the coefficients mean? Remember the coefficients are on the log scale. So the mean abundance at a pollution level of zero = <code>{r} exp(coef(m1)[1])</code> and a change in pollution from 0 to 1 causes an estimated <code>{r} 1/exp(coef(m1)[2])</code> times decline in fish abundance.</p>
<p>Let’s also plot the fitted model with standard errors.</p>
<pre><code>ypredict &lt;- predict(m1, type = "response", se = TRUE)
plot(x, yexp, type = 'l', xlab = "Pollution level",
     ylab = "Number of fish counted",
     ylim = c(0, 8))
lines(x, ypredict$fit, lwd = 2, col = "red", lty = 2)
#Add lines for standard errors
lines(x, ypredict$fit + ypredict$se.fit, lty = 3, col = "red")
lines(x, ypredict$fit - ypredict$se.fit, lty = 3, col = "red")
#plot observations
points(x, yobs_pois)
legend('topright', legend = c("True mean", "Estimated mean"),
       lwd = 2, lty = c(1,2), col = c("black", "red"))</code></pre>
<p><img src="beauty-of-the-glm-link_files/figure-markdown_strict/unnamed-chunk-8-1.png" class="img-fluid"></p>
<p>You can see the fitted line falls close to the ‘true’ line, and the standard errors are pretty tight around our best estimate.</p>
<p>The fitting algorithm itself is attempting the maximise the log-likelihood of the observations given the mean (in technical speak). You can read <a href="http://www.seascapemodels.org/rstats/2018/04/13/how-to-use-the-AIC.html">more about likelihoods here</a>.</p>
<p>It is also worth noting that we still need to do assumption checks, like we would for a regression with normal errors. For instance, we can check the model’s residuals (the difference between the data and the model’s predicted values) to see that the residual variance approximately equals the mean. A cool way to check assumptions of the Poisson model is to use ‘rootograms’, look it up.</p>
</section>
<section id="the-beauty-of-the-link-combining-linear-models-with-bespoke-distributions-to-describe-natural-processes" class="level2">
<h2 class="anchored" data-anchor-id="the-beauty-of-the-link-combining-linear-models-with-bespoke-distributions-to-describe-natural-processes">The beauty of the link: combining linear models with bespoke distributions to describe natural processes</h2>
<p>So in my introduction I claimed that maths of GLMs is beautiful. I think that because the maths is nicely coherent with the way nature often works.</p>
<p>We wanted to fit a linear function to data that can’t be less than zero, because linear functions are convenient to work with. So we used a log link function to describe the mean and to ensure that the mean is always greater than zero.</p>
<p>We ended up with a model where the slope describes multiples of change in fish abundance over the pollution gradient. So the model itself is actually multiplicative, not additive.</p>
<p>If you think about it, natural processes that generate counts often are multiplicative, not additive. For instance, we may talk about ‘fish multiplying’ when they breed, because population growth can be exponential.</p>
<p>So our mathematically convenient link function actually ended up being a better description of the natural process.</p>
<p>The effort to use a non-negative model also forced us to think about using a more appropriate distribution for the data: the Poisson rather than the Normal. The Poisson has the variance increasing with the mean.</p>
<p>Once again, natural processes that generate counts often lead to increases in the variance in situations where we count more. Counts near zero will naturally have low variance, because they are constrained by zero, whereas higher counts will naturally have a greater variabilty.</p>
<p>You can also relax the assumption of mean = variance with other GLM distributions like the negative binomial.</p>
<p>It turns out that proper models of variance are crucial for <a href="https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/2041-210X.12552">getting the standard-errors right, and so crucial for detecting real effects over spurious ones</a>.</p>
<p>Imagine if you used a Normal distribution and assumed equal variances. You might spuriously attribute differences between groups from high counts to some covariate, but the difference is actually just natural variation. Conversely, you might miss differences between groups with low counts, because a smaller difference at low counts should actually be statistically significant.</p>
<p>The increased power we get to detect differences at low counts with a GLM over a regression happens because it is the multiple of the difference that matters with the log link, not the absolute (additive) difference.</p>
<p>My final point is to remember that coefficients from a model with a log link (and some other links too, like the logit) are multiplicative. This can be very useful when it comes to making sense of your results and may change the way you present your findings.</p>
<p>For instance, we used this key insight from a GLM to make a case that <a href="https://www.sciencedirect.com/science/article/pii/S0006320716310461">pollution from logging causes a 24 times decline in the abundance of a threatened fish species</a>.</p>
<p>Before we considered using the GLM, we had actually presented the results in terms of a % change in fish abundance. But % are not as easy to generalize, because they depend on your baseline. Multiples do not.</p>
<p>Hope you found this post helpful, and as always you can get me on <a href="https://twitter.com/bluecology">Twitter</a> if you have comments or questions.</p>
<section id="homework-for-the-keen-whats-the-difference-between-a-log-link-and-log-transforming-your-data" class="level3">
<h3 class="anchored" data-anchor-id="homework-for-the-keen-whats-the-difference-between-a-log-link-and-log-transforming-your-data">Homework for the keen: What’s the difference between a log link and log transforming your data?</h3>
<p>I wanted to add a brief appendix to address this question, because the answer is insightful as to how link functions work.</p>
<p>Try take the data we generated above and fit two GLMs (you will have to add a small number so you can log the zeros, not ideal but a common practice)</p>
<pre><code>yobsplus &lt;- yobs_pois+0.1
model1 &lt;- glm(yobsplus ~ x, family = gaussian(link = "log"))
model2 &lt;- glm(log(yobsplus) ~ x, family = gaussian(link = "identity"))</code></pre>
<p>In the first model we fitted a Gaussian (=Normal distributed errors) with a log link. In the second we fitted a Gaussian to log(y) with the identity link (which is no link).</p>
<p>Now compare the results. Notice that the estimate of the slope is quite different. Why is this?</p>
<p>The model with the log link is fitting the mean on the log scale, the Gaussian errors will be on the natural scale. So the residual (or error) variance will be constant for all mean values of y.</p>
<p>The model with the log of the data and identity link is fitting the mean and variance on the log scale. So if we retransform log(y) back to y, the variance will change with the mean.</p>
<p>So a log link isn’t the same as a log transformation. The transformation changes the raw data. The link function doesn’t touch the raw data, instead you can think of it as a transformation of the <strong>model for the mean of the raw data</strong>.</p>
<hr>
</section>
</section>
<section id="post-2021-05-28-terra-raster-comparison" class="level2">
<h2 class="anchored" data-anchor-id="post-2021-05-28-terra-raster-comparison">POST: 2021-05-28-terra-raster-comparison</h2>
<p>Path: posts/2021-05-28-terra-raster-comparison/index.md</p>
</section>
</section>
<section id="a-comparison-of-terra-and-raster-packages" class="level1">
<h1>A comparison of terra and raster packages</h1>
<p>The <code>terra</code> package looks designed to replace an old favourite <code>raster</code>. It is made by a similar team. The <code>terra</code> documentation states “can do more, is simpler to use, and it is faster.”</p>
<p>So should you make the switch to <code>terra</code>? I’ll answer that here.</p>
<p>TLDR: <code>terra</code> is simpler and faster than <code>raster</code> and will be easy for existing <code>raster</code> users to learn. Compatibility with other packages can be an issue, but conversion back to <code>raster</code> objects is easy. Verdict: make the switch.</p>
<p>There are a few important considerations when changing packages:</p>
<ol type="1">
<li><p>How long will it take me to learn the new syntax?</p></li>
<li><p>How much help is available online?</p></li>
<li><p>Is it faster than what I used to use?</p></li>
<li><p>Will it be compatible with other packages I use?</p></li>
</ol>
<p>I will test each in turn.</p>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The data</h2>
<p>We’ll use <a href="https://www.seascapemodels.org/data/data-wrangling-spatial-course-data.zip">this data from one of my courses</a>.</p>
</section>
<section id="how-long-will-it-take-to-learn-terras-syntax" class="level2">
<h2 class="anchored" data-anchor-id="how-long-will-it-take-to-learn-terras-syntax">1 How long will it take to learn terra’s syntax?</h2>
<p>First, let’s take a look at some basic syntax and compare it with raster</p>
<p>You can read in data much the same way, with the command <code>rast()</code>:</p>
<pre><code>library(terra)
r &lt;- rast("data-for-course/spatial-data/MeanAVHRRSST.grd")
plot(r)</code></pre>
<p><img src="2021-05-28-terra-raster-comparison/unnamed-chunk-1-1.png" class="img-fluid"></p>
<pre><code>ext(r)

## SpatExtent : 82.5, 181.25, -72.25, -9.75 (xmin, xmax, ymin, ymax)</code></pre>
<p>Now let’s crop and reproject it:</p>
<pre><code>#create an extent object
ext2 &lt;- ext(r)

#constrain it in x direction
ext2[1] &lt;- 120
ext2[2] &lt;- 170

r2 &lt;- crop(r, ext2)

r3 &lt;- project(r2, "+proj=robin +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0")

plot(r3)</code></pre>
<p><img src="2021-05-28-terra-raster-comparison/unnamed-chunk-2-1.png" class="img-fluid"></p>
<p>So much of the syntax is familiar (or identical), if slightly different. It took me about 10 minutes to translate what I know from raster to terra syntax.</p>
<p>Note there are some important caveats with terra when it comes to cluster computations and saving data see <code>?terra</code> for more information.</p>
</section>
<section id="how-much-help-is-available-online" class="level2">
<h2 class="anchored" data-anchor-id="how-much-help-is-available-online">2 How much help is available online?</h2>
<p>It’s early days yet. But the terra package documentation is outstanding, as good as it was for raster. This was one reason raster became so popular.</p>
<p><code>?terra</code> provides a very helpful description, a menu of functions and at the very end a translation of function names from raster to terra (many are the same)</p>
<p>So users will be once again grateful to Robert Hijmans and the authorship team for the effort tney put into package documentation</p>
<p>There are a few courses/ blogs online if you google it and some limited posts on stackexchange sites.</p>
<p>No vignette with the package as yet.</p>
<p>So the verdict is that the documentation of the package and functions is excellent. Currently, there is limited existing documentation of troubleshooting errors and bugs online. So you might have to ask yourself. But online content will grow as the package becomes more popular.</p>
</section>
<section id="is-terra-faster-than-raster" class="level2">
<h2 class="anchored" data-anchor-id="is-terra-faster-than-raster">3 Is terra faster than raster?</h2>
<p>I take the author’s word that its faster, but let’s see how much faster:</p>
<pre><code>library(microbenchmark)

r_raster &lt;- raster::raster("data-for-course/spatial-data/MeanAVHRRSST.grd")
robin_proj &lt;- "+proj=robin +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs +towgs84=0,0,0"

tout &lt;- microbenchmark(
project(r, robin_proj),
raster::projectRaster(r_raster, crs = robin_proj),
times = 10
)
tout

## Unit: milliseconds
##                                               expr     median    
##                             project(r, robin_proj)      76.3  
##  raster::projectRaster(r_raster, crs = robin_proj)     529.6</code></pre>
<p>So something like 7 times faster for the computationally demanding task of reprojecting a raster.</p>
</section>
<section id="will-terra-be-compatible-with-other-packages-i-use" class="level2">
<h2 class="anchored" data-anchor-id="will-terra-be-compatible-with-other-packages-i-use">4 Will terra be compatible with other packages I use?</h2>
<p>The answer here obviously depends on what packages you want to use. A key one for me is tmap for mapping. This now works with <code>terra</code>.</p>
<p>But at the time of first writing this post my version of <code>tmap</code> was out of date and <code>terra</code> wasn’t compatible with <code>tmap</code>. So if you package isn’t compatible, the next question, how onerous is it to convert a <code>terra</code> raster to a <code>raster</code> raster?</p>
<p>Here’s a demonstration (with my out of date version of <code>tmap</code>)</p>
<pre><code>library(tmap)

r_raster &lt;- raster::raster(r)

tm_shape(r_raster) +
  tm_raster()</code></pre>
<p><img src="2021-05-28-terra-raster-comparison/unnamed-chunk-4-1.png" class="img-fluid"></p>
<p>The multi-tool function <code>raster()</code> does the job, so I’ll take that for now.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p><code>terra</code> looks set to replace <code>raster</code>. It is faster and just as easy to use as <code>raster</code>. Making the switch to <code>terra</code> isn’t as hard as it may seem, its use will seem very familiar to <code>raster</code> users.</p>
<p>There are probably common errors and bugs with particular data types for the R community to find and there isn’t help online for those yet. There will be challenges in compatibility with other packages. But conversion back to <code>raster</code> objects is easy.</p>
<p>There are also new features in <code>terra</code>, to handle vector data and manage very large datasets. So plenty more to explore.</p>
<hr>
</section>
<section id="post-2019-03-18-bayesian-timeline" class="level2">
<h2 class="anchored" data-anchor-id="post-2019-03-18-bayesian-timeline">POST: 2019-03-18-bayesian-timeline</h2>
<p>Path: posts/2019-03-18-bayesian-timeline/index.md</p>
<p>Here’s my timeline of going from frequentist stats to becoming a fully fledged Bayesian eco-statistician.</p>
<p><strong>2006</strong> Read the <em>Ecological Detective</em> (Hilborn and Walters), the philosophy makes sense, the history of falsification is interesting but, geez, the maths looks hard.</p>
<p><strong>2008</strong> Started PhD. Peers also interested in Bayes stats. But, Prof gets angry and tells us “ANOVA is all you will ever need”. We rebel and start a study group on that James Clark book with elephants on the front cover.</p>
<p>Geez, the maths is even harder than I remember.</p>
<p>Not comfortable with the ‘subjective’ aspect of Bayesian stats (AKA prior information). But its ok to use Bayesian stats for its flexibility, so long as we use ‘uninformed’ priors.</p>
<p><strong>2009</strong> Read that Mick McCarthy book with the frog on the front cover. Start playing around in WinBUGS. BUGS code breaks the mystery of mixed effects models in R. MM models are just a series of equations, and much more than the obscure magic of R model formulas.</p>
<p><strong>2014</strong> Actually published a paper on something with statistics in it (first time ever). (<a href="">Interdependency of tropical marine ecosystems in response to climate change</a>). Used frequentist GLM. Leant heavily on advice in that Zuur, Ieno et al.&nbsp;book that has penguins on the front cover.</p>
<p><strong>2017</strong> Publish first <a href="">Bayesian eco-stats paper</a>. Went all out with a bespoke non-linear latent variable GLM in JAGS. Use broad ‘uninformed priors’, because the data should speak for themselves.</p>
<p>Brian Fry convinces me there is a big problem with the ‘uninformed priors’ used in isotope mixing models. Studies with poor data seem to unwittingly present the priors as their result.</p>
<p><strong>Winter 2017</strong> Obsessed with the apparent simplicity and speed of the INLA rstats package for Bayesian GLMMs. Frequently taking hot baths in evening to read the latest INLA pre-print. Wife thinks I’m odd.</p>
<p>(Later on realize INLA is very fast, but not so simple)</p>
<p><strong>Autumn 2018</strong> Started paper about sharks with regular frequentist GAMs. Finished paper with Bayesian GAMMs, because lead author wants random effects in a time-series model AND “confidence intervals” plotted on the graph. Too hard with GAMs, easy with Bayes.</p>
<p>Publish paper on how <a href="">Bayesian isotope mixing models</a> can’t have uninformed priors. It is just mathematically impossible. Now convinced we should always use prior information to develop Bayesian priors.</p>
<p>Obsession with reading INLA in the bath vindicated by publishing in Nature.</p>
<p>Read about ‘penalized complexity priors’. Now convinced priors for random effects should be ‘informed’ (or regularizing), even if we don’t have prior information.</p>
<p><strong>2018/2019</strong> Read that red and black MacElreath’s book about rethinking. Agree that using informed priors for fixed effects is actually more conservative than broad priors.</p>
<p>In fact, realize now that no prior is truly ‘uninformed’, some are just broader than others. Broad priors can’t be ‘uninformed’, because they are just are informed about a high variance.</p>
<p><strong>2019</strong> Used INLA and Bayesian stats to do a simple linear regression. Never going back to frequentist.</p>
<p>Convinced postdoc to use informed priors for his model. Model works much better, results make much more sense.</p>
<p><strong>2020</strong> Insist PhD students have to use Bayesian stats over frequentist stats too?</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.seascapemodels\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>