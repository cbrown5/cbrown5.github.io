<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2018-08-20">

<title>Guide to posting pre-prints for ecologists – Seascapemodels</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f93c2b1f3f0577f377aefa4848a86a36.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-6.7.2/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-6.7.2/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Seascapemodels</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../bluecology_blog.html"> 
<span class="menu-text"><i class="fa-regular fa-newspaper" aria-label="newspaper"></i> Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../people.html"> 
<span class="menu-text"><i class="fa-regular fa-user" aria-label="user"></i> People</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../code.html"> 
<span class="menu-text"><i class="fa-solid fa-laptop-code" aria-label="laptop-code"></i> R tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com.au/citations?hl=en&amp;user=1qG6yFMAAAAJ&amp;view_op=list_works&amp;sortby=pubdate"> 
<span class="menu-text"><i class="fa-brands fa-google-scholar" aria-label="google-scholar"></i></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://discover.utas.edu.au/C.J.Brown"> 
<span class="menu-text"><i class="fa-solid fa-building-columns" aria-label="building-columns"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/cbrown5"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/bluecology.bsky.social"> 
<span class="menu-text"><i class="fa-brands fa-bluesky" aria-label="bluesky"></i></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/christopher-brown-32466785/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Guide to posting pre-prints for ecologists</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">research-skills</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 20, 2018</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>I just posted my fourth pre-print to <a href="https://submit.biorxiv.org/">bioRXiv</a> (pronounced bio-archive), a pre-print server. On doing so I realised that the whole process is pretty opaque, so I wanted to provied a guide here.</p>
<p>If you are not familiar with bioRXiv, or other pre-print servers, they allow you to share an open-access pre-review version.</p>
<p>The broad aim of pre-print servers is to allow science to progress more rapidly, because others don’t need to wait for peer-review and the articles are open-access and free to anyone.</p>
<p>As I submitted my fourth article, it occurred to me that there is a bit of a process for submitting one efficiently, and for avoiding some issues associated with pre-prints. So here I wanted to cover a brief user guide for posting pre-prints.</p>
<p>The guide is based on the opportunities and problems I have come across during my (very short) pre-print posting career.</p>
<p>But first, let’s look at the pros and cons of even posting one in the first place.</p>
<section id="pros-and-cons" class="level2">
<h2 class="anchored" data-anchor-id="pros-and-cons">Pros and cons</h2>
<p>The broader benefits and costs have been well covered in the blogosphere, but a few key points are listed here. A good guide to pros and cons was written up in <a href="http://www.sciencemag.org/news/2017/09/are-preprints-future-biology-survival-guide-scientists">sciencemag</a>. The blog <a href="https://smallpondscience.com/2017/07/24/whats-up-with-preprints/">Small Pond Science</a> also has a very reasoned article about why its author doesn’t post pre-prints.</p>
<p><strong>Pros</strong></p>
<ul>
<li><p>Other scientists can use (and cite) your article sooner.</p></li>
<li><p>The pre-print will be open-access, even if your peer-reviewed version is pay-walled.</p></li>
<li><p>Gain exposure for your work without waiting for review, which can be particularly important for early career scientists.</p></li>
<li><p>You can share articles with the science community that you perhaps never intend to publish in a peer-reviewed journal, like this <a href="https://www.biorxiv.org/content/early/2016/11/28/088278">guide to structuring papers</a>. They will also have a DOI so you can get credit for citations.</p></li>
<li><p>You claim priority for a piece of work that someone else may be about to publish.</p></li>
<li><p>There is the opportunity to gain pre-review comments that may help improve your article.</p></li>
</ul>
<p><strong>Cons</strong></p>
<p>I think most of the cons can actually be avoided or mitigated. The first oft cited one is that someone might ‘steal’ your ideas and scoop your work. Though in reality I think this is a very rare occurrence. Might be worth considering though if you are working on very hot topic.</p>
<p>The second is that some journals don’t support pre-prints, though I haven’t encountered any. Even Science and Nature support pre-prints.</p>
<p>The next few issues are important, but are discussed more rarely in the broader blogosphere.</p>
<p>The third problem is that some journals don’t support you talking to the press about pre-prints. For instance Science Magazine may take any pre-publication press into account when making a decision on your article. Easy to avoid this problem, just don’t do a press release on your article, the press are unlikely to hear about it on their own.</p>
<p>A fourth problem is that pre-prints can reveal the identity of a paper’s authors, which may break double-blind peer review. A reviewer apparently googled one of my paper titles that was under double blind peer review and find the pre-print (a dubious practice perhaps?). Then they wrote in their review - Chris you should never post pre-prints before submitting the article.</p>
<p>But what’s the point of a pre-print if it isn’t posted pre-review? I think its the authors’ prerogative to decide whether they might waive anonymity for the sake of a pre-print (an issue I did consider before submitting said paper). Either way, I think it is a potential issue you should consider, particularly if you want double-blind review.</p>
<p>I look forwards to starting a debate between the double-blind proponents and the pre-print proponents on Twitter one day so, but will leave that for another blog.</p>
<p>The final and I think most problematic issue that I see is that there will be multiple versions of your paper online once it is published. <a href="https://smallpondscience.com/2017/07/24/whats-up-with-preprints/">This blog</a> has a more detailed discussion of how that is potentially an issue. If your paper changes considerably in peer-review, then these different versions may also have very different content. The multiple version problem is something that is worth considering carefully.</p>
<p>One more note, bioRXiv is sponsored by the Chan Zuckerberg (ie Facebook’s CEO and his surgeon wife) initiative. You might want to consider what they want to do with all these pre-prints. Purportedly they are just interested in speeding up science to help with breakthroughs in medicine…</p>
<p>See my guide below for how you can mitigate the final issue.</p>
<p>Overall I think the pros <strong>just</strong> outweigh the cons. I started posting pre-prints because I was using other people’s to inform my science, so it made sense to post my own. Having said that I don’t post every article as a pre-print and largely let my students decide whether they want to do it or not.</p>
<p>If you follow my guide below it will help you avoid some of the cons and maximise some of the pros.</p>
</section>
<section id="practical-considerations" class="level2">
<h2 class="anchored" data-anchor-id="practical-considerations">Practical considerations</h2>
<p>A few practical considerations are worth mentioning. People are in such a rush to publish these days and pre-prints can actually slow you down a bit…</p>
<p>There is a slight time cost to preprints. You have to submit them like any other journal and I’ve never met a scientist that enjoys working their way through a journal submission page…</p>
<p>A pre-print may actually slow down publication of your paper by a few days or weeks. There is a time lag (~24 hours) involved in uploading it and then waiting for it to appear online before submitting to a journal. This is lag is longer if you want to wait to get comments.</p>
</section>
<section id="guide-to-submitting-and-revising-pre-prints" class="level2">
<h2 class="anchored" data-anchor-id="guide-to-submitting-and-revising-pre-prints">Guide to submitting and revising pre-prints</h2>
<p>I am going to assume you are working on submitting something to bioRXiv.</p>
<p><strong>1. Finish your article and gain approval from coauthors</strong></p>
<p>You should always check with your coauthors before posting a pre-print. You also might want to check the pre-print policy of your target journal.</p>
<p>I recommend create a finished version, like what you would be happy to submit for peer-review (or better!). This article will be free and open to the world, so you will have to live with it for ever! Make sure you have coauthors, or even a colleague, check over it before submitting it to.</p>
<p>DON’T SUBMIT IT TO A JOURNAL YET. Technically you need to get your bioRXiv article up before submitting to a peer-reviewed journal.</p>
<p><strong>1b. Formatting!</strong></p>
<p>The document as you upload it will be the preprint that everyone can access. I prefer to upload PDFs so I have full control over how they look. Some points to consider:</p>
<ul>
<li><p>Add footnotes with the page number, your name and perhaps the title and a statement about it being a pre-print. This ensures if the document is downloaded and distributed it is clear who wrote it and that it is pre-review.</p></li>
<li><p>Make sure your email is somewhere in the document. So people can contact you easily.</p></li>
<li><p>I like the put figures and tables in the text, rather than at the end (which is how some backwards journals want them submitted), just because I find it annoying to flip back and forwards in the document when reading it.</p></li>
<li><p>Don’t forget to check references are correctly entered etc…</p></li>
</ul>
<p><strong>2. Sign up for bioRXiv and get an ORCID</strong></p>
<p>It all works better if you have an ORCID I’ve found. Then pre-prints will link to your other profiles.</p>
<p><strong>3. Follow the steps to upload your article</strong></p>
<p>This is pretty similar to the standard journal submission process. Some journals even allow you to submit your pre-print directly.</p>
<p><strong>4. Choose your licence</strong></p>
<p>One important step is that you will get to choose the license your article is distributed under. There are many choices. I use the attribution commercial and non-commercial license. This means people can re-use the article so long as they attribute the source. I allow commercial use because that includes teaching and textbooks. Put some thought into this though, this license also will mean that a book doesn’t have to pay you a fee to use the figures for instance.</p>
<p><strong>5. Submit and approve the article to bioRXiv</strong></p>
<p>Then it should appear on bioRXiv in a day or so.</p>
<p><strong>6. Tell other scientists about it</strong></p>
<p>This is important only if you want feedback. I usually post them on Twitter and perhaps email a few people. If you are serious about getting pre-review comments, then this step is essential. It is unlikely that people will just see the article on bioRXiv.</p>
<p>You can also link the article to your Google Scholar page if you wish. This is how some colleagues have found out about my latest work (Google Scholar stalking me, but don’t laugh I know we all do it).</p>
<p>Make sure you check the comments option under your bioRXiv article too, I don’t think you get alerts if someone posts to this (though it seems to be rare).</p>
<p><strong>7. Submit to a peer-reviewed journal</strong></p>
<p>You can do this straight away after it appears on bioRXiv, or wait a few weeks to get pre-review comments.</p>
<p><strong>8. Revise your pre-print BEFORE your article is accepted at a peer-review journal</strong></p>
<p>Your can’t revise pre-prints once the article is accepted at a peer-review journal. I tried to update a title once and was blocked - it seems bioRXiv automatically searches the literature for matching titles (and can find accepted articles even before they are posted online!). If they find your article listed at a journal they will block you from revising it.</p>
<p>It is important to revise it to minimise issues with having different versions on the web. For instance, people may be confused about similar articles with slightly different titles.</p>
<p>Check the journal’s copyright policy though, some consider that they own the rights to review comments and your revisions, in which case any revision to your pre-print based on review comments may be illegal. Other publishers apparently allow posting of the accepted version as a pre-print.</p>
<p><strong>9. Optional: Do press on your article</strong></p>
<p>As I said above, some journals don’t like press/media attention before publication. Also I think it is bad for science if we start sharing work that isn’t peer-reviewed with the general public. Peer-review, with all its flaws, is still our gold standard for making sure science is robust and credible.</p>
<p><strong>10. Check your pre-print links to the published article</strong></p>
<p>If the title of the pre-print and the published article are identical (ie not even one word different) then the preprint should automatically link to the published article. So your work can be properly attributed (and cites won’t be split across different versions).</p>
<p>If the titles are different and they don’t pick up the published version, you can email bioRXiv the published paper once it has been out at least 2 weeks and they say they will fix it.</p>
<p><strong>11. Optional: Check links to your article on search engines</strong></p>
<p>You might want to check if search engines, e.g.&nbsp;Google Scholar, pick up on the open-access pdf version of your article. If they don’t you can also try posting the post-review, pre-print version to a university repository or your webpage or ResearchGate (if the journal’s license allows you to do so, which many do).</p>
</section>
<section id="my-personal-experience" class="level2">
<h2 class="anchored" data-anchor-id="my-personal-experience">My personal experience</h2>
<p>So far my personal experience has been mixed. The first article I posted went through peer-review at an OA journal so quickly that the pre-print was pretty redundant in the end.</p>
<p>The second article has been stuck in review/resubmit cycle for ages! The pre-print has actually been cited, though it is still not published. I am a bit worried how different the pre-print and the published version may be, though I just need to make sure I submit a revision before it is accepted.</p>
<p>The third article has just been accepted and I just realised the title was changed in review. So I need to make sure it links back. Aside from that they are pretty similar.</p>
<p>The fourth article I just submitted. I am in no rush to publish it, so am going to wait a few weeks and seek pre-review comments on the article. Will update you how that goes. Hopefully the article will be stronger when it comes to submission. For instance I plan on seeking feedback from some statisticians who wouldn’t likely be approached by the journal’s editor.</p>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>That’s the guide. Consider carefully whether pre-prints are for you, or not. Some people are rampant pre-print advocates or haters, don’t take their word for it though. The reality is that there is a mix of benefits and costs. If you take a few steps you can maximise those benefits and dodge some of the costs.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.seascapemodels\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>