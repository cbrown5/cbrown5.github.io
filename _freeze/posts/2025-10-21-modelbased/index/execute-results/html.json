{
  "hash": "2e92649669037b190580ce33b10d3e19",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate: '10/21/2025'\ntitle: modelbased package for plotting interactions\ncategories: research\npublished: true\n---\n\nI've been a big fan of the `visreg` package for a while, it makes it convenient to plot predictions from models. But recently I was struggling with a model that had many two-way interactions terms. \n\nI checked out the key alternative to `visreg`, `ggeffects`, which is very popular (the paper has over 2000 citations). But the `ggeffects` page states it will be superseded by the [`modelbased` package]((https://easystats.github.io/modelbased/)). So here's a quick demo of how to use `modelbased` to plot interaction effects from a GLM.\n\n`modelbased` is part of an ecosystem of packages for handling statistical models: [`easystats`](https://easystats.github.io/modelbased/reference/estimate_slopes.html#references). \n\n\nFirst I'm going to load data on coral cover and fish abundance from my [Example ecological data](https://github.com/cbrown5/example-ecological-data) repo: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(easystats)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n# Attaching packages: easystats 0.7.5 (red = needs update)\n✔ bayestestR  0.17.0   ✔ correlation 0.8.8 \n✖ datawizard  1.2.0    ✔ effectsize  1.0.1 \n✔ insight     1.4.2    ✔ modelbased  0.13.0\n✖ performance 0.15.1   ✔ parameters  0.28.2\n✔ report      0.6.1    ✔ see         0.12.0\n\nRestart the R-Session and update packages with `easystats::easystats_update()`.\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(readr)\n# Load data from https://github.com/cbrown5/example-ecological-data\n\ndat_url <- \"https://raw.githubusercontent.com/cbrown5/example-ecological-data/refs/heads/main/data/benthic-reefs-and-fish/fish-coral-cover-sites.csv\"\n\n#Convert counts of coral to proportions\ndat <- read_csv(dat_url) %>%\n    mutate(\n        cb_cover = cb_cover / n_pts, \n        soft_cover = soft_cover / n_pts\n    ) \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 49 Columns: 13\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (2): flow, logged\ndbl (11): site, reef.id, pres.topa, pres.habili, secchi, coordx, coordy, cb_...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\nNow we'll fit a simple poisson GLM. `pres.topa` is count of topa fish, a fish that likes to live in branching corals (`cb_cover`), and `logged` is a binary variable indicating whether the site was near to logging or not (which causes pollution that harms fish and corals).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1 <- glm(pres.topa ~ cb_cover *  logged,\n          data = dat,\n          family = poisson)\nsummary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = pres.topa ~ cb_cover * logged, family = poisson, \n    data = dat)\n\nCoefficients:\n                          Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                 -3.839      1.124  -3.415 0.000639 ***\ncb_cover                     8.691      1.979   4.392 1.12e-05 ***\nloggedNot logged             5.313      1.136   4.675 2.93e-06 ***\ncb_cover:loggedNot logged   -7.830      2.017  -3.882 0.000104 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 426.61  on 48  degrees of freedom\nResidual deviance: 265.33  on 45  degrees of freedom\nAIC: 353.22\n\nNumber of Fisher Scoring iterations: 6\n```\n\n\n:::\n:::\n\n\nIt simple to then plot the interaction effects. I'm going to do so on `link` scale (log scale for poisson models): \n\n\n::: {.cell}\n\n```{.r .cell-code}\npr <- estimate_means(m1, by = c(\"cb_cover\", \"logged\"),\n        estimate = \"typical\",\n        type = \"link\")\n\nplot(pr) +\n    labs(\n        x = \"Hard coral cover\",\n        y = \"Predicted Topa abundance (log scale)\",\n        color = \"Soft coral cover\", \n        fill = \"Soft coral cover\"\n    ) +  \n    theme_classic()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nOne neat thing that `modelbased` does is give you different options for how to estimate marginal means. The default is \"typical\", which estimates marginal means at the average value of numerical predictors and averages over frequencies of categorical predicotrs. But you can also do \"average\" which averages over sample distributions and \"population\" which attemps to create a counterfactual for all possible combinations of variables. \n\nThese answer different questions, see the [documentation for more details](https://easystats.github.io/modelbased/reference/estimate_means.html).\n\nI'm going to make a dataframe of all three methods so we can compare them:\n\n\n::: {.cell}\n\n```{.r .cell-code}\npr_typical <- estimate_means(m1, by = \"cb_cover\",\n        estimate = \"typical\",\n        type = \"link\")\n\npr_average <- estimate_means(m1, \n    by = list(cb_cover = unique(dat$cb_cover)),\n        estimate = \"average\",\n        type = \"link\")\n\npr_population <- estimate_means(m1, by = c(\"cb_cover\"),\n        estimate = \"population\",\n        type = \"link\")\n\npr_all <- bind_rows(\n    pr %>% mutate(method = \"typical by logging\"),\n    pr_typical %>% mutate(method = \"typical\"),\n    pr_average %>% mutate(method = \"average\"),\n    pr_population %>% mutate(method = \"population\")\n)\n```\n:::\n\n\nNow we plot them: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(pr_all, aes(x = cb_cover, y = Mean, color = logged)) +\n    geom_point() +\n    geom_linerange(aes(ymin = CI_low, ymax = CI_high)) +\n    facet_wrap(~method) +\n    labs(\n        x = \"Hard coral cover\",\n        y = \"Predicted Topa abundance (log scale)\",\n        color = \"Logged\"\n    ) +  \n    theme_classic()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nAnd one more plot just of population and typical to more easily see the diffence: \n\n\n::: {.cell}\n\n```{.r .cell-code}\npd <- position_dodge(width = 0.05)\npr_all %>%\n    filter(method %in% c(\"population\", \"typical\")) %>%\nggplot(., aes(x = cb_cover, y = Mean, color = method)) +\n    geom_point(position = pd) +\n    geom_linerange(aes(ymin = CI_low, ymax = CI_high), \n    position = pd) +\n    labs(\n        x = \"Hard coral cover\",\n        y = \"Predicted Topa abundance (log scale)\",\n        color = \"Logged\"\n    ) +  \n    theme_classic()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nYou can see see some key differences. The typical method shows effects of hard coral cover for a typical observation. There are slightly more unlogged than logged sites in the data: \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable(dat$logged)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n    Logged Not logged \n        21         28 \n```\n\n\n:::\n:::\n\n\nSo the typical sample is different from a balanced  population level average. \n\nThe population and typical predictions fall in between the predictions that are conditional on logging status, because both are kinds of averages over the two logging categories. \n\nPredictions from the 'average' method show an inconsistent pattern, because they are averaging over samples. You can roughly see the trends for logged and unlogged sites.\n\nFinally, let's convince ourselves that the unbalanced data is causing these differences. I'm going to randomly remove some unlogged sites to create a balanced dataset, and refit the model:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#randomly remove 7 'Not logged' sites to create balance\nset.seed(707)\nirm <- sample(which(dat$logged == \"Not logged\"), 7)\ndat2 <- dat[-irm, ]\n\nm2 <- glm(pres.topa ~ cb_cover *  logged,\n          data = dat2,\n          family = poisson)\n\npr_typical2 <- estimate_means(m2, by = \"cb_cover\",\n        estimate = \"typical\",\n        type = \"link\")\n\npr_population2 <- estimate_means(m2, by = c(\"cb_cover\"),\n        estimate = \"population\",\n        type = \"link\")\n\npr_all2 <- bind_rows(\n    pr_typical2 %>% mutate(method = \"typical\"),\n    pr_population2 %>% mutate(method = \"population\")\n)\n\npd <- position_dodge(width = 0.02)\nggplot(pr_all2, aes(x = cb_cover, y = Mean, \n        color = method)) +\n    geom_point(position = pd) +\n    geom_linerange(aes(ymin = CI_low, ymax = CI_high),\n        position = pd) +\n    labs(\n        x = \"Hard coral cover\",\n        y = \"Predicted Topa abundance (log scale)\",\n        color = \"Logged\"\n    ) +  \n    theme_classic()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nYou can see the two types of predictions are identical with balanced data. ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}